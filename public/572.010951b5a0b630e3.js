"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[572],{1576:(v,g,r)=>{r.d(g,{Y:()=>h});var l=r(6895),p=r(4731),a=r(8256);let h=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=a.oAB({type:d}),d.\u0275inj=a.cJS({imports:[l.ez,p.Pc]}),d})()},572:(v,g,r)=>{r.r(g),r.d(g,{AuditoryDetailPageModule:()=>I});var l=r(6895),p=r(433),a=r(4731),h=r(655),d=r(7368),m=r(2340),t=r(8256),f=r(1032),A=r(2424),D=r(2414),Z=r(3916),y=r(1433),T=r(6280),x=r(4372),S=r(1006);function P(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"div",12)(1,"ion-button",13),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.onGoingBack())}),t._UZ(2,"ion-icon",14),t.qZA()()}}function _(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"ion-content")(1,"ion-list",15)(2,"ion-item",16),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.downloadPdf())}),t.TgZ(3,"ion-label"),t._uU(4,"Descargar PDF"),t.qZA()(),t.TgZ(5,"ion-item",16),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.downloadCsv())}),t.TgZ(6,"ion-label"),t._uU(7,"Descargar CSV"),t.qZA()()()()}}function U(o,s){if(1&o&&(t.TgZ(0,"p",17)(1,"strong"),t._uU(2,"Fecha:"),t.qZA(),t._uU(3),t.qZA()),2&o){const i=t.oxw();t.xp6(3),t.AsE(" ",i.auditoryDate," ",i.auditoryTime,"")}}function w(o,s){if(1&o&&(t.TgZ(0,"p")(1,"strong"),t._uU(2,"Descripci\xf3n:"),t.qZA(),t._uU(3),t.qZA()),2&o){const i=t.oxw();t.xp6(3),t.hij(" ",i.auditoryDescription,"")}}function b(o,s){1&o&&t._UZ(0,"img",18),2&o&&t.Q6J("src",s.$implicit,t.LSH)}function E(o,s){if(1&o&&(t.TgZ(0,"p"),t._UZ(1,"img",22),t.qZA()),2&o){const i=t.oxw().$implicit,e=t.oxw(2);t.xp6(1),t.Q6J("src",e.answerEvicenceUrl(i.dir),t.LSH)}}function O(o,s){if(1&o&&(t.TgZ(0,"div")(1,"p")(2,"strong"),t._uU(3),t.qZA()(),t.TgZ(4,"p"),t._uU(5),t.qZA(),t.YNc(6,E,2,1,"p",8),t.qZA()),2&o){const i=s.$implicit;t.xp6(3),t.hij(" ",i.uid+".- "+i.sentence," "),t.xp6(2),t.Oqu(i.formattedAnswer),t.xp6(1),t.Q6J("ngIf",i.dir)}}function F(o,s){if(1&o&&(t.TgZ(0,"div",19)(1,"h5",20),t._uU(2),t.qZA(),t.TgZ(3,"h6",20),t._uU(4),t.qZA(),t.YNc(5,O,7,3,"div",21),t.qZA()),2&o){const i=s.$implicit;t.xp6(2),t.Oqu(i.name),t.xp6(2),t.Oqu(i.subname),t.xp6(1),t.Q6J("ngForOf",i.answers)}}let Y=(()=>{class o{constructor(i,e,n,c,u,M,N,$,L){this.auditoryService=i,this.loadingService=e,this.responseService=n,this.mapService=c,this.route=u,this.platform=M,this.router=N,this.confirmDialogService=$,this.platformDownloadService=L,this.backUrl=(0,d.Zh)("remote"),this.auditoryId="0",this.auditoryTitle="",this.auditoryDate="",this.auditoryTime="",this.auditoryDescription="",this.auditoryCloseNote="",this.auditoryLat="",this.auditoryLng="",this.yesScore=0,this.notScore=0,this.auditoyrEvidences=[],this.auditorySections=[],this.platform.backButton.subscribeWithPriority(9999,()=>{this.router.navigateByUrl(this.backUrl)})}ionViewWillEnter(){this.route.paramMap.subscribe({next:i=>{i.has("id")?(this.loadingService.showLoading(),this.auditoryId=i.get("id")||"0",this.auditoryService.getRemoteDetail(this.auditoryId).subscribe({next:e=>{this.setAuditory(e.data)},error:e=>this.responseService.onError(e,"No se pudo recuperar la auditor\xeda")})):this.router.navigateByUrl(this.backUrl)}}).unsubscribe()}setAuditory(i){this.auditoryTitle=i.auditory.title,this.auditoryDate=i.auditory.date,this.auditoryTime=i.auditory.time,this.auditoryDescription=i.auditory.description,this.auditoryCloseNote=i.auditory.close_note,this.auditoryLat=i.auditory.lat,this.auditoryLng=i.auditory.lng,this.auditoyrEvidences=i.auditory.evidences.map(e=>`${m.T0}/auditories/${e.dir}.jpeg`),this.auditorySections=i.sections,this.auditorySections.forEach(e=>e.answers=e.answers.map(n=>{0!=+n.score&&(1==+n.answer?this.yesScore++:this.notScore++);const c=n.answers.startsWith("[")?JSON.parse(n.answers).find(u=>+u.v==+n.answer):void 0;return Object.assign(Object.assign({},n),{formattedAnswer:c?c.t:n.answer})}).sort((n,c)=>n.indx-c.indx)),this.auditorySections.sort((e,n)=>e.indx-n.indx),this.mapService.setCenter(+this.auditoryLat,+this.auditoryLng,!0),setTimeout(()=>{this.loadingService.dismissLoading()},500)}answerEvicenceUrl(i){return`${m.T0}/answers/${i}.jpeg`}downloadCsv(){this.confirmDialogService.presentAlert("\xbfDesea descargar en formato CSV?",()=>{const e=this.auditorySections.map(c=>c.answers.map(u=>`${c.name},${c.subname?c.subname:"-"},${u.uid},${u.sentence.replace(",",";")},${u.formattedAnswer}`).join("\n")).join("\n"),n=new Blob([`Secci\xf3n,SubSecci\xf3n,Identificador,Pregunta,Respuesta\n${e}`],{type:"text/csv"});this.platformDownloadService.downloadBlob(n,this.auditoryTitle,"csv")})}downloadPdf(){this.confirmDialogService.presentAlert("\xbfDesea descargar en formato PDF?",()=>{this.loadingService.showLoading(),this.auditoryService.downloadPdf(this.auditoryId).subscribe({next:i=>(0,h.mG)(this,void 0,void 0,function*(){return this.platformDownloadService.downloadBlob(i,this.auditoryTitle,"pdf")}),error:i=>this.responseService.onError(i,"No se pudo descargar la auditor\xeda")})})}onGoingBack(){this.router.navigateByUrl(this.backUrl)}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(f.P),t.Y36(A.b),t.Y36(D.J),t.Y36(Z.S),t.Y36(y.gz),t.Y36(a.t4),t.Y36(y.F0),t.Y36(T.D),t.Y36(x.A))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-auditory-detail"]],decls:22,vars:7,consts:[[1,"row","mt-2","mx-0"],["class","col",4,"ngIf"],[1,"col","text-end"],["id","c1","size","small"],["slot","icon-only","name","cloud-download"],["trigger","c1","triggerAction","click",3,"dismissOnSelect"],[1,"mx-2","mt-4"],["class","mt-4",4,"ngIf"],[4,"ngIf"],[1,"mt-2"],["width","100%","class","mb-2",3,"src",4,"ngFor","ngForOf"],["class","mx-2 mt-2 border-bottom",4,"ngFor","ngForOf"],[1,"col"],["size","small",3,"click"],["slot","icon-only","name","arrow-back-outline"],["lines","none"],["button","",3,"click"],[1,"mt-4"],["width","100%",1,"mb-2",3,"src"],[1,"mx-2","mt-2","border-bottom"],[1,"text-center"],[4,"ngFor","ngForOf"],["width","100%",3,"src"]],template:function(i,e){1&i&&(t.TgZ(0,"ion-content")(1,"div",0),t.YNc(2,P,3,0,"div",1),t.TgZ(3,"div",2)(4,"ion-button",3),t._UZ(5,"ion-icon",4),t.qZA(),t.TgZ(6,"ion-popover",5),t.YNc(7,_,8,0,"ng-template"),t.qZA()()(),t.TgZ(8,"div",6)(9,"h1"),t._uU(10),t.qZA(),t.YNc(11,U,4,2,"p",7),t.YNc(12,w,4,1,"p",8),t.TgZ(13,"p")(14,"strong"),t._uU(15,"Ubicaci\xf3n:"),t.qZA(),t._UZ(16,"app-map"),t.qZA(),t.TgZ(17,"p")(18,"strong",9),t._uU(19,"Fotograf\xedas del entorno:"),t.qZA(),t.YNc(20,b,1,1,"img",10),t.qZA(),t.YNc(21,F,6,3,"div",11),t.qZA()()),2&i&&(t.xp6(2),t.Q6J("ngIf",e.backUrl),t.xp6(4),t.Q6J("dismissOnSelect",!0),t.xp6(4),t.Oqu(e.auditoryTitle),t.xp6(1),t.Q6J("ngIf",e.auditoryDate),t.xp6(1),t.Q6J("ngIf",e.auditoryDescription),t.xp6(8),t.Q6J("ngForOf",e.auditoyrEvidences),t.xp6(1),t.Q6J("ngForOf",e.auditorySections))},dependencies:[l.sg,l.O5,a.YG,a.W2,a.gu,a.Ie,a.Q$,a.q_,a.d8,S.G],encapsulation:2}),o})();var B=r(1576),J=r(3375);const C=[{path:"",component:Y}];let I=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[l.ez,p.u5,a.Pc,y.Bz.forChild(C),B.Y,J.R]}),o})()}}]);