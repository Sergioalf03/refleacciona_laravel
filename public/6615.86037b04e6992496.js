"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6615],{76:(B,p,r)=>{r.d(p,{GW:()=>c,dk:()=>v,oK:()=>i});var i=(()=>{return(l=i||(i={})).Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS",i;var l})(),c=(()=>{return(l=c||(c={})).Rear="REAR",l.Front="FRONT",c;var l})(),v=(()=>{return(l=v||(v={})).Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",v;var l})()},1443:(B,p,r)=>{r.d(p,{ez:()=>c,tP:()=>i});var i=(()=>{return(o=i||(i={})).Documents="DOCUMENTS",o.Data="DATA",o.Library="LIBRARY",o.Cache="CACHE",o.External="EXTERNAL",o.ExternalStorage="EXTERNAL_STORAGE",i;var o})(),c=(()=>{return(o=c||(c={})).UTF8="utf8",o.ASCII="ascii",o.UTF16="utf16",c;var o})()},1067:(B,p,r)=>{r.d(p,{ez:()=>c.ez,fy:()=>v,tP:()=>c.tP});var i=r(7423),c=r(1443);const v=(0,i.fo)("Filesystem",{web:()=>r.e(6364).then(r.bind(r,6364)).then(l=>new l.FilesystemWeb)})},6769:(B,p,r)=>{r.d(p,{$:()=>y});var i=r(8256),c=r(1433),v=r(6895),l=r(4731);function o(g,s){if(1&g){const a=i.EpF();i.TgZ(0,"div",3)(1,"ion-button",4),i.NdJ("click",function(){i.CHM(a);const u=i.oxw();return i.KtG(u.onGoingBack())}),i._UZ(2,"ion-icon",5),i.qZA()()}}function U(g,s){if(1&g){const a=i.EpF();i.TgZ(0,"div",6)(1,"ion-button",4),i.NdJ("click",function(){i.CHM(a);const u=i.oxw();return i.KtG(u.onGoingHome())}),i._UZ(2,"ion-icon",7),i.qZA()()}}function t(g,s){if(1&g){const a=i.EpF();i.TgZ(0,"div",6)(1,"ion-button",4),i.NdJ("click",function(){i.CHM(a);const u=i.oxw();return i.KtG(u.customButton.click())}),i._UZ(2,"ion-icon",8),i.qZA()()}if(2&g){const a=i.oxw();i.xp6(2),i.Q6J("name",a.customButton.icon)}}let y=(()=>{class g{constructor(a){this.router=a}ngOnInit(){}onGoingHome(){this.router.navigateByUrl(this.homeUrl)}onGoingBack(){this.router.navigateByUrl(this.backUrl)}}return g.\u0275fac=function(a){return new(a||g)(i.Y36(c.F0))},g.\u0275cmp=i.Xpm({type:g,selectors:[["app-header-buttons"]],inputs:{homeUrl:"homeUrl",backUrl:"backUrl",customButton:"customButton"},decls:4,vars:3,consts:[[1,"row","mt-2","mx-0"],["class","col",4,"ngIf"],["class","col text-end",4,"ngIf"],[1,"col"],["size","small",3,"click"],["slot","icon-only","name","arrow-back-outline"],[1,"col","text-end"],["slot","icon-only","name","home-sharp"],["slot","icon-only",3,"name"]],template:function(a,d){1&a&&(i.TgZ(0,"div",0),i.YNc(1,o,3,0,"div",1),i.YNc(2,U,3,0,"div",2),i.YNc(3,t,3,1,"div",2),i.qZA()),2&a&&(i.xp6(1),i.Q6J("ngIf",d.backUrl),i.xp6(1),i.Q6J("ngIf",d.homeUrl),i.xp6(1),i.Q6J("ngIf",d.customButton))},dependencies:[v.O5,l.YG,l.gu],encapsulation:2}),g})()},1576:(B,p,r)=>{r.d(p,{Y:()=>l});var i=r(6895),c=r(4731),v=r(8256);let l=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=v.oAB({type:o}),o.\u0275inj=v.cJS({imports:[i.ez,c.Pc]}),o})()},6250:(B,p,r)=>{r.d(p,{T:()=>t});var i=r(655),c=r(7423),v=r(76);const l=(0,c.fo)("Camera",{web:()=>r.e(3954).then(r.bind(r,3954)).then(y=>new y.CameraWeb)});var o=r(1067),U=r(8256);let t=(()=>{class y{constructor(){this.takePicture=()=>(0,i.mG)(this,void 0,void 0,function*(){return yield l.getPhoto({quality:90,source:v.oK.Camera,resultType:v.dk.Uri})}),this.openGallery=()=>(0,i.mG)(this,void 0,void 0,function*(){return yield l.pickImages({quality:90,limit:1})}),this.convertBlobToBase64=s=>new Promise((a,d)=>{const u=new FileReader;u.onerror=d,u.onload=()=>{a(u.result)},u.readAsDataURL(s)})}saveLocalLogo(s){return(0,i.mG)(this,void 0,void 0,function*(){const a=yield this.readAsBase64(s);yield o.fy.writeFile({path:"logo.jpeg",data:a,directory:o.tP.Data})})}saveLocalAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const d=yield this.readAsBase64(s),u=`${a}-AUD${this.generateName()}`;return yield o.fy.writeFile({path:u,data:d,directory:o.tP.Data}),u})}saveLocalHelmetAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const d=yield this.readAsBase64(s),u=`${a}-HEL${this.generateName()}`;return yield o.fy.writeFile({path:u,data:d,directory:o.tP.Data}),u})}saveLocalBeltAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const d=`${a}-BEL${this.generateName()}`;return yield o.fy.writeFile({path:d,data:s,directory:o.tP.Data}),d})}saveLocalGeneralCountAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const d=`${a}-GCO${this.generateName()}`;return yield o.fy.writeFile({path:d,data:s,directory:o.tP.Data}),d})}saveLocalAnswerEvidence(s,a,d){return(0,i.mG)(this,void 0,void 0,function*(){const u=yield this.readAsBase64(s),P=`${a}-ANS${d}-${this.generateName()}`;return yield o.fy.writeFile({path:P,data:u,directory:o.tP.Data}),P})}getLocalAuditoryEvidence(s){return o.fy.readFile({path:s,encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalAuditoryEvidenceUri(s){return o.fy.getUri({path:s,directory:o.tP.Data})}getLocalAnswerEvidence(s){return o.fy.readFile({path:s,encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalAnswerEvidenceUri(s){return o.fy.getUri({path:s,directory:o.tP.Data})}removeLocalAuditoryEvidence(s){return o.fy.deleteFile({path:s,directory:o.tP.Data})}removeLocalAnswerEvidence(s){return o.fy.deleteFile({path:s,directory:o.tP.Data})}generateName(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";let d="";for(let u=0;u<64;u++)d+=s.charAt(Math.floor(Math.random()*s.length));return`${d}.png`}getLocalLogo(){return o.fy.readFile({path:"logo.jpeg",encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalLogoUri(){return o.fy.getUri({path:"logo.jpeg",directory:o.tP.Data})}readAsBase64(s){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.convertBlobToBase64(s)})}onTakePicture(s){return(0,i.mG)(this,void 0,void 0,function*(){})}}return y.\u0275fac=function(s){return new(s||y)},y.\u0275prov=U.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},6615:(B,p,r)=>{r.r(p),r.d(p,{HelmetAuditoryListPageModule:()=>M});var i=r(6895),c=r(4731),v=r(655),l=r(313),o=r(7368),U=r(7423),t=r(8256),y=r(1005),g=r(2740),s=r(4112),a=r(6250),d=r(2414),u=r(2424),P=r(1433),x=r(6280),S=r(6769);function C(h,E){if(1&h){const e=t.EpF();t.TgZ(0,"div",5)(1,"h4",6),t._uU(2,"Sin conteos"),t.qZA(),t.TgZ(3,"ion-button",7),t.NdJ("click",function(){t.CHM(e);const m=t.oxw();return t.KtG(m.onNewAuditory())}),t._uU(4,"Iniciar uno nuevo"),t.qZA()()}}function F(h,E){if(1&h&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&h){const e=t.oxw().$implicit;t.xp6(1),t.hij("Fecha: ",e.date,"")}}function H(h,E){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",12),t.NdJ("click",function(){t.CHM(e);const m=t.oxw().$implicit,A=t.oxw();return t.KtG(A.presentActionSheetOptions(m))}),t._UZ(1,"ion-icon",13),t.qZA()}}function N(h,E){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",12),t.NdJ("click",function(){t.CHM(e);const m=t.oxw().$implicit,A=t.oxw();return t.KtG(A.onRemoteDetail(m.id))}),t._UZ(1,"ion-icon",14),t.qZA()}}function O(h,E){if(1&h&&(t.TgZ(0,"ion-item",8)(1,"ion-label")(2,"h2",9),t._uU(3),t.qZA(),t.YNc(4,F,2,1,"p",10),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.YNc(7,H,2,0,"ion-button",11),t.YNc(8,N,2,0,"ion-button",11),t.qZA()),2&h){const e=E.$implicit,n=t.oxw();t.xp6(3),t.hij("T\xedtulo: ",e.title,""),t.xp6(1),t.Q6J("ngIf",e.date),t.xp6(2),t.hij("Estado: ",e.statusWord,""),t.xp6(1),t.Q6J("ngIf",!n.sendedList),t.xp6(1),t.Q6J("ngIf",n.sendedList)}}let I=(()=>{class h{constructor(e,n,m,A,_,b,f,D,L,T,R){this.auditoryService=e,this.auditoryEvidenceService=n,this.helmetCollectionService=m,this.photoService=A,this.responseService=_,this.loadingService=b,this.router=f,this.confirmDialogService=D,this.actionSheetCtrl=L,this.route=T,this.platform=R,this.auditories=[],this.sendedList=!1,this.loading=!1,this.customButton={click:()=>this.router.navigateByUrl(this.formUri),icon:"add"},this.backUri=(0,o.CE)(),this.formUri=(0,o.iB)("00"),this.platform.backButton.subscribeWithPriority(9999,()=>{this.router.navigateByUrl(this.backUri)})}ionViewWillEnter(){return(0,v.mG)(this,void 0,void 0,function*(){this.route.paramMap.subscribe({next:e=>{e.has("origin")?"remote"===e.get("origin")?this.fetchRemoteList():this.fetchLocalList():this.router.navigateByUrl(this.backUri)}}).unsubscribe()})}onGoingHome(){this.router.navigateByUrl(this.backUri)}onEdit(e){this.router.navigateByUrl((0,o.iB)(e))}onNewAuditory(){this.router.navigateByUrl((0,o.iB)("00"))}onUpload(e){this.confirmDialogService.presentAlert("Una vez enviado el registro no se podr\xe1 modificar. \xbfDesea continuar?",()=>{this.loadingService.showLoading(),this.auditoryService.getUpdateData(e).subscribe({next:n=>{n!==l.W&&setTimeout(()=>{this.helmetCollectionService.getList(e).subscribe({next:m=>{if(m!==l.W){const A={title:n.values[0].title,description:n.values[0].description,close_note:n.values[0].close_note,date:n.values[0].date,time:n.values[0].time,lat:n.values[0].lat,lng:n.values[0].lng,status:n.values[0].status,creation_date:n.values[0].creation_date,update_date:n.values[0].update_date,external_id:n.values[0].id,user_id:n.values[0].user_id},_=m.values.map(f=>({helmet_auditory_id:f.helmet_auditory_id,origin:f.origin,destination:f.destination,users_count:f.users_count,helmets_count:f.helmets_count,creation_date:f.creation_date}));this.auditoryService.upload({auditory:A,counts:_}).subscribe({next:f=>{const D=f.data.id;this.auditoryService.updateExternalId(e,D).subscribe({next:L=>{L!==l.W&&setTimeout(()=>{this.uploadAuditoryPhotos(e,D)},20)}})},error:f=>this.responseService.onError(f,"No se pudo subir la auditor\xeda")})}}})},20)}})})}uploadAuditoryPhotos(e,n){this.auditoryEvidenceService.getEvidencesByAuditory(e).subscribe({next:m=>(0,v.mG)(this,void 0,void 0,function*(){m!==l.W&&this.uploadAuditoryEvidence(m.values,0,n).then(A=>{this.auditoryService.finalDelete(e).subscribe({next:_=>{_!==l.W&&(this.responseService.onSuccess("Auditor\xeda enviada exit\xf3samente"),setTimeout(()=>{this.fetchLocalList()},100))}})})})})}uploadAuditoryEvidence(e,n,m){return(0,v.mG)(this,void 0,void 0,function*(){return new Promise((_,b)=>(0,v.mG)(this,void 0,void 0,function*(){if(n===e.length)return _(!0);const f=yield this.photoService.getLocalAuditoryEvidenceUri(e[n].dir).then(L=>L.uri),D=yield fetch(U.dV.convertFileSrc(f)).then(L=>L.blob());this.auditoryEvidenceService.uploadImage(D,m,e[n].creation_date,e[n].dir).subscribe({next:()=>{this.photoService.removeLocalAuditoryEvidence(e[n].dir).then(()=>{this.auditoryEvidenceService.localRemove(e[n].dir).subscribe({next:L=>{L!==l.W&&this.uploadAuditoryEvidence(e,n+1,m).then(T=>_(T))}})})},error:L=>this.responseService.onError(L,"No se pudo subir la imagen")})}))})}onDelete(e){this.confirmDialogService.presentAlert("\xbfDesea eliminar el registro?",()=>{this.loadingService.showLoading(),this.auditoryService.deleteLocal(e).subscribe({next:n=>{n!==l.W&&(this.responseService.onSuccess("Registro eliminado"),setTimeout(()=>{this.fetchLocalList()},100))},error:n=>{this.responseService.onError(n,"No se pudo eliminar el registro")}})})}onDetail(e){this.router.navigateByUrl((0,o.F$)(e))}onRemoteDetail(e){this.router.navigateByUrl((0,o.f7)(e))}onDownloadPdf(e,n){this.confirmDialogService.presentAlert("\xbfDesea descargar el archivo?",()=>{this.loadingService.showLoading(),this.auditoryService.downloadPdf(e).subscribe({next:m=>{const A=m,_="data.pdf";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(A,_);else{const b=window.document.createElement("a");b.href=window.URL.createObjectURL(new Blob([A],{type:"application/pdf"})),b.download=_,document.body.appendChild(b),b.click(),document.body.removeChild(b)}},error:m=>this.responseService.onError(m,"No se pudo descargar la auditor\xeda")})})}presentActionSheetOptions(e){return(0,v.mG)(this,void 0,void 0,function*(){const n=this.sendedList?[{text:"Ver Conteo",handler:()=>this.onRemoteDetail(e.id)},{text:"Descargar Conteo",handler:()=>this.onDownloadPdf(e.id,e.title)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}]:e.countId?[{text:"Env\xedar Conteo",handler:()=>this.onUpload(e.id)},{text:"Actualizar Conteo",handler:()=>this.onDetail(e.id)},{text:"Actualizar Datos Generales",handler:()=>this.onEdit(e.id)},{text:"Eliminar Conteo",role:"destructive",handler:()=>this.onDelete(e.id)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}]:[{text:"Actualizar Conteo",handler:()=>this.onDetail(e.id)},{text:"Actualizar Datos Generales",handler:()=>this.onEdit(e.id)},{text:"Eliminar Conteo",role:"destructive",handler:()=>this.onDelete(e.id)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}];yield(yield this.actionSheetCtrl.create({header:"Opciones",mode:"ios",buttons:n})).present()})}fetchLocalList(){this.sendedList=!1,this.loadingService.showLoading(),this.loading=!0,this.auditoryService.getLocalList().subscribe({next:e=>{e!==l.W&&(this.auditories=e.map(n=>Object.assign(Object.assign({},n),{statusWord:1===n.status?"En progreso":"Terminada"})),this.loading=!1,this.loadingService.dismissLoading())},error:e=>{this.responseService.onError(e,"No se pudieron recuperar las auditor\xedas")}})}fetchRemoteList(){this.sendedList=!0,this.loadingService.showLoading(),this.auditoryService.getRemoteList().subscribe({next:e=>{this.sendedList=!0,this.auditories=e.data.map(n=>Object.assign(Object.assign({},n),{statusWord:"Enviado"})),this.loadingService.dismissLoading()},error:e=>{this.responseService.onError(e,"No se pudieron recuperar las auditor\xedas"),this.fetchLocalList()}})}}return h.\u0275fac=function(e){return new(e||h)(t.Y36(y.G),t.Y36(g.R),t.Y36(s.C),t.Y36(a.T),t.Y36(d.J),t.Y36(u.b),t.Y36(P.F0),t.Y36(x.D),t.Y36(c.BX),t.Y36(P.gz),t.Y36(c.t4))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-helmet-auditory-list"]],decls:15,vars:6,consts:[[3,"customButton","backUrl"],[1,"mx-2","mt-2"],["class","text-center",4,"ngIf"],["class","mt-2 txtInput",4,"ngFor","ngForOf"],["expand","full",3,"disabled","click"],[1,"text-center"],[1,"mt-2"],[3,"click"],[1,"mt-2","txtInput"],[1,"text-start"],[4,"ngIf"],["slot","end","size","small",3,"click",4,"ngIf"],["slot","end","size","small",3,"click"],["slot","icon-only","name","menu"],["slot","icon-only","name","eye"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content"),t._UZ(1,"app-header-buttons",0),t.TgZ(2,"div",1)(3,"h1"),t._uU(4,"Uso de casco"),t.qZA(),t.YNc(5,C,5,0,"div",2),t.YNc(6,O,9,5,"ion-item",3),t.qZA()(),t.TgZ(7,"ion-footer")(8,"ion-row")(9,"ion-col")(10,"ion-button",4),t.NdJ("click",function(){return n.fetchLocalList()}),t._uU(11,"SIN ENVIAR"),t.qZA()(),t.TgZ(12,"ion-col")(13,"ion-button",4),t.NdJ("click",function(){return n.fetchRemoteList()}),t._uU(14,"ENVIADAS"),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("customButton",n.customButton)("backUrl",n.backUri),t.xp6(4),t.Q6J("ngIf",!n.loading&&0===n.auditories.length),t.xp6(1),t.Q6J("ngForOf",n.auditories),t.xp6(4),t.Q6J("disabled",!n.sendedList),t.xp6(3),t.Q6J("disabled",n.sendedList))},dependencies:[i.sg,i.O5,c.YG,c.wI,c.W2,c.fr,c.gu,c.Ie,c.Q$,c.Nd,S.$],encapsulation:2}),h})();var Z=r(1576);const G=[{path:"",component:I}];let M=(()=>{class h{}return h.\u0275fac=function(e){return new(e||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[i.ez,c.Pc,P.Bz.forChild(G),Z.Y]}),h})()}}]);