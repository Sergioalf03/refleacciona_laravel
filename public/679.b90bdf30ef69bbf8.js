"use strict";(self.webpackChunkCallesMasSeguras=self.webpackChunkCallesMasSeguras||[]).push([[679],{3679:(Y,v,s)=>{s.r(v),s.d(v,{BeltDetailModule:()=>O});var p=s(6814),u=s(594),h=s(5861),f=s(553),d=s(8433),t=s(9212),x=s(2529),b=s(677),C=s(5066),w=s(9051),Z=s(2634),m=s(9032),T=s(4237),g=s(2150),r=s(2500);const S=["slickModal"];function D(n,a){if(1&n&&t._UZ(0,"div",26),2&n){const e=t.oxw();t.Q6J("leafletOptions",e.markers)("leafletLayers",e.layers)}}function _(n,a){if(1&n&&(t.TgZ(0,"div",36)(1,"div",37),t._UZ(2,"img",38),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.s9C("src",e,t.LSH)}}function y(n,a){if(1&n&&(t.TgZ(0,"div",39)(1,"div",40),t._UZ(2,"img",38),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.s9C("src",e,t.LSH)}}function A(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",27)(1,"h5",25),t._uU(2,"Entorno"),t.qZA(),t.TgZ(3,"div",28)(4,"ngx-slick-carousel",29,30),t.YNc(6,_,3,1,"div",31),t.qZA(),t.TgZ(7,"div",32),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.nextSlide())}),t.qZA(),t.TgZ(8,"div",33),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.previousSlide())}),t.qZA(),t.TgZ(9,"ngx-slick-carousel",34),t.YNc(10,y,3,1,"div",35),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(4),t.Q6J("config",e.slideConfig),t.xp6(2),t.Q6J("ngForOf",e.evidences),t.xp6(3),t.Q6J("config",e.slidesConfig),t.xp6(),t.Q6J("ngForOf",e.evidences)}}function I(n,a){1&n&&(t.TgZ(0,"div",41)(1,"span",42),t._uU(2,"Loading..."),t.qZA()())}function U(n,a){1&n&&(t.TgZ(0,"span",43),t._UZ(1,"i",44),t.qZA())}function k(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",45)(1,"a",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.downloadPdf())}),t._uU(2,"Descargar PDF"),t.qZA(),t.TgZ(3,"a",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.downloadCsv())}),t._uU(4,"Descargar CSV"),t.qZA()()}}function B(n,a){1&n&&(t.TgZ(0,"div",47)(1,"span",42),t._uU(2,"Loading..."),t.qZA()())}function L(n,a){if(1&n&&(t.TgZ(0,"h4",48),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(),t.Oqu(e.title)}}function J(n,a){if(1&n&&(t.TgZ(0,"div",49)(1,"h5",25),t._uU(2,"Descripci\xf3n:"),t.qZA(),t.TgZ(3,"p",50),t._uU(4),t.qZA()()),2&n){const e=t.oxw();t.xp6(4),t.Oqu(e.description)}}let F=(()=>{class n{constructor(e,o,i,l,c,Q){this.beltService=e,this.route=o,this.responseService=i,this.confirmDialogService=l,this.downloadPlatformService=c,this.loadingService=Q,this.BASE_URL=f._n,this.id="0",this.title="",this.description="",this.createdAt="",this.publishedAt="",this.layers=[],this.evidences=[],this.beltlessCount=0,this.beltCount=0,this.chairCount=0,this.detailLoading=!0,this.downloadLoading=!1,this.slideConfig={infinite:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0},this.slidesConfig={infinite:!0,slidesToShow:4,slidesToScroll:1,autoplay:!0}}ngOnInit(){this.breadCrumbItems=[{label:"Uso de cintur\xf3n"},{label:"Detalle",active:!0}],this.route.paramMap.subscribe({next:e=>{this.id=e.get("id")||"0",this.beltService.getDetail(this.id).subscribe({next:o=>{this.markers={layers:[(0,d.tileLayer)("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidGhlbWVzYnJhbmQiLCJhIjoiY2xmbmc3bTV4MGw1ejNzbnJqOWpubzhnciJ9.DNkdZVKLnQ6I9NOz7EED-w",{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xa9 <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1})],zoom:13,zoomControl:!1,center:(0,d.latLng)(o.data.lat,o.data.lng)};var i=new d.Icon.Default;i.options.shadowSize=[0,0],i.options.iconUrl="../../../assets/icons/CI.png",i.options.iconSize=[24,24],i.options.iconRetinaUrl="../../../assets/icons/CI.png";const l=(0,d.marker)([o.data.lat,o.data.lng],{draggable:!1,icon:i});this.layers.push(l),this.title=o.data.title,this.description=o.data.description,this.createdAt=`${o.data.date} ${o.data.time}`,this.evidences=o.data.evidences.map(c=>this.getAuditoryUrl(c.dir)),this.beltCount=o.data.counts[0].belts_count,this.beltlessCount=o.data.counts[0].adults_count,this.chairCount=o.data.counts[0].chairs_count,this.detailLoading=!1},error:o=>{this.responseService.onError(o,"No se pudo recuperar la auditor\xeda"),this.detailLoading=!1}})}})}getAuditoryUrl(e){return f._n+"/storage/belt/"+e+".jpeg"}previousSlide(){this.slickModal.slickPrev()}nextSlide(){this.slickModal.slickNext()}downloadCsv(){this.confirmDialogService.showDialog("Confirmaci\xf3n","\xbfDesea descargar en formato CSV?").then(e=>{if(e.isConfirmed){this.downloadLoading=!0;const l=new Blob(["\ufeffTipo,conteo\n"+("Sin Cintur\xf3n,"+this.beltlessCount+"\nCon Cintur\xf3n,"+this.beltCount+"\nCon Silla de Retenci\xf3n,"+this.chairCount+"\n")],{type:"text/csv;charset=utf-8"});this.downloadPlatformService.downloadBlob(l,this.title,"csv"),this.downloadLoading=!1}})}downloadPdf(){var e=this;this.confirmDialogService.showDialog("Confirmaci\xf3n","\xbfDesea descargar en formato PDF?").then(o=>{var i;o.isConfirmed&&(this.downloadLoading=!0,this.loadingService.show(),this.beltService.downloadPdf(this.id).subscribe({next:(i=(0,h.Z)(function*(l){e.downloadPlatformService.downloadBlob(l,e.title,"pdf"),e.downloadLoading=!1}),function(c){return i.apply(this,arguments)}),error:i=>{this.responseService.onError(i,"No se pudo descargar el archivo"),this.downloadLoading=!1}}))})}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(x.i),t.Y36(u.gz),t.Y36(b.J),t.Y36(C.D),t.Y36(w.A),t.Y36(Z.b))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-belt-detail"]],viewQuery:function(o,i){if(1&o&&t.Gf(S,5),2&o){let l;t.iGM(l=t.CRH())&&(i.slickModal=l.first)}},decls:38,vars:12,consts:[[1,"row"],[1,"col-xl-8","offset-xl-2"],["title","Detalle de uso de cintur\xf3n",3,"breadcrumbItems"],[1,"col-xl-4"],[1,"card"],[1,"card-body"],[1,"fs-md"],["style","height: 300px;","leaflet","",3,"leafletOptions","leafletLayers",4,"ngIf"],["class","card p-3 sticky-side-div",4,"ngIf"],[1,"col-xl-8"],[1,"row","g-0"],[1,"col"],[1,"card","rounded-end-0"],[1,"card-body","p-4"],["dropdown","",1,"dropdown","float-end"],["dropdownToggle","","href","javascript:void(0);",1,"text-reset","dropdown-btn","btn","btn-primary","p-0","px-1"],["class","spinner-border spinner-border-sm text-light","role","status",4,"ngIf"],["class","fs-xl",4,"ngIf"],["class","dropdown-menu dropdown-menu-end",4,"bsDropdownMenu"],["class","spinner-border spinner-border-sm","role","status",4,"ngIf"],["class","text-capitalize mb-3",4,"ngIf"],[1,"hstack","gap-3","flex-wrap"],[1,"text-muted"],[1,"text-body","fw-medium"],["class","mt-4",4,"ngIf"],[1,"fs-md","mb-3"],["leaflet","",2,"height","300px",3,"leafletOptions","leafletLayers"],[1,"card","p-3","sticky-side-div"],[1,"product-img-slider"],[1,"carousel","swiper","product-thumbnail-slider","p-2","rounded","bg-light",3,"config"],["slickModal",""],["ngxSlickItem","","class","slide",4,"ngFor","ngForOf"],[1,"slick-next","slick-arrow","swiper-button-nexts",3,"click"],[1,"slick-prev","slick-arrow","swiper-button-prevs",3,"click"],[1,"carousel","swiper","product-nav-slider","mt-2",3,"config"],["ngxSlickItem","","class","swiper-slide swiperlist me-2",4,"ngFor","ngForOf"],["ngxSlickItem","",1,"slide"],[1,"mx-4"],["alt","",1,"img-fluid","d-block",3,"src"],["ngxSlickItem","",1,"swiper-slide","swiperlist","me-2"],[1,"nav-slide-item"],["role","status",1,"spinner-border","spinner-border-sm","text-light"],[1,"visually-hidden"],[1,"fs-xl"],[1,"mdi","mdi-download","align-middle","text-white"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0);",1,"dropdown-item","pointer",3,"click"],["role","status",1,"spinner-border","spinner-border-sm"],[1,"text-capitalize","mb-3"],[1,"mt-4"],[1,"text-muted","mb-0"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"app-breadcrumbs",2),t.TgZ(3,"div",0)(4,"div",3)(5,"div",4)(6,"div",5)(7,"h5",6),t._uU(8,"Ubicaci\xf3n"),t.qZA(),t.YNc(9,D,1,2,"div",7),t.qZA()(),t.YNc(10,A,11,4,"div",8),t.qZA(),t.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"a",15),t.YNc(18,I,3,0,"div",16)(19,U,2,0,"span",17),t.qZA(),t.YNc(20,k,5,0,"div",18),t.qZA(),t.YNc(21,B,3,0,"div",19)(22,L,2,1,"h4",20),t.TgZ(23,"div",21)(24,"div",22),t._uU(25,"Realizado : "),t.TgZ(26,"span",23),t._uU(27),t.qZA()()(),t.YNc(28,J,5,1,"div",24),t.qZA()()()(),t.TgZ(29,"div",4)(30,"div",13)(31,"div")(32,"h5",25),t._uU(33),t.qZA(),t.TgZ(34,"h5",25),t._uU(35),t.qZA(),t.TgZ(36,"h5",25),t._uU(37),t.qZA()()()()()()()()),2&o&&(t.xp6(2),t.Q6J("breadcrumbItems",i.breadCrumbItems),t.xp6(7),t.Q6J("ngIf",i.markers),t.xp6(),t.Q6J("ngIf",i.evidences.length>0),t.xp6(8),t.Q6J("ngIf",i.downloadLoading),t.xp6(),t.Q6J("ngIf",!i.downloadLoading),t.xp6(2),t.Q6J("ngIf",i.detailLoading),t.xp6(),t.Q6J("ngIf",!i.detailLoading),t.xp6(5),t.Oqu(i.createdAt),t.xp6(),t.Q6J("ngIf",i.description),t.xp6(5),t.hij("Usuarios sin cintur\xf3n: ",i.beltlessCount,""),t.xp6(2),t.hij("Usuarios con cintur\xf3n: ",i.beltCount,""),t.xp6(2),t.hij("Usuarios con silla de retenci\xf3n: ",i.chairCount,""))},dependencies:[p.sg,p.O5,m.vE,m.Xg,T.n,g.je,g.x,r.Hz,r.Mq,r.TO],encapsulation:2})}return n})();var M=s(3744),z=s(6208);const N=[{path:"",component:F}];let O=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[p.ez,u.Bz.forChild(N),M.t,m.Sv,z.m,g.UO,r.mr,u.Bz]})}return n})()}}]);