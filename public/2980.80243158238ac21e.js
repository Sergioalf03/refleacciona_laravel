"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2980],{2980:(L,d,o)=>{o.r(d),o.d(d,{HelmetAuditoryDetailPageModule:()=>w});var l=o(6895),u=o(433),a=o(4731),m=o(655),g=(o(6551),o(7368)),h=o(2340),t=o(8256),p=o(1005),v=o(2424),y=o(2414),f=o(3916),c=o(1433),A=o(6280),D=o(4372),T=o(1006);function Z(e,s){if(1&e){const i=t.EpF();t.TgZ(0,"div",10)(1,"ion-button",11),t.NdJ("click",function(){t.CHM(i);const r=t.oxw();return t.KtG(r.onGoingBack())}),t._UZ(2,"ion-icon",12),t.qZA()()}}function x(e,s){if(1&e){const i=t.EpF();t.TgZ(0,"ion-content")(1,"ion-list",13)(2,"ion-item",14),t.NdJ("click",function(){t.CHM(i);const r=t.oxw();return t.KtG(r.downloadPdf())}),t.TgZ(3,"ion-label"),t._uU(4,"Descargar PDF"),t.qZA()(),t.TgZ(5,"ion-item",14),t.NdJ("click",function(){t.CHM(i);const r=t.oxw();return t.KtG(r.downloadCsv())}),t.TgZ(6,"ion-label"),t._uU(7,"Descargar CSV"),t.qZA()()()()}}function S(e,s){if(1&e&&(t.TgZ(0,"p",15)(1,"strong"),t._uU(2,"Fecha:"),t.qZA(),t._uU(3),t.qZA()),2&e){const i=t.oxw();t.xp6(3),t.AsE(" ",i.auditoryDate," ",i.auditoryTime,"")}}function P(e,s){if(1&e&&(t.TgZ(0,"p")(1,"strong"),t._uU(2,"Descripci\xf3n:"),t.qZA(),t._uU(3),t.qZA()),2&e){const i=t.oxw();t.xp6(3),t.hij(" ",i.auditoryDescription,"")}}function H(e,s){1&e&&t._UZ(0,"img",18),2&e&&t.Q6J("src",s.$implicit,t.LSH)}function U(e,s){if(1&e&&(t.TgZ(0,"p")(1,"strong",16),t._uU(2,"Fotograf\xedas del entorno:"),t.qZA(),t.YNc(3,H,1,1,"img",17),t.qZA()),2&e){const i=t.oxw();t.xp6(3),t.Q6J("ngForOf",i.auditoyrEvidences)}}function C(e,s){if(1&e&&(t.TgZ(0,"div",19)(1,"div",20)(2,"ion-item",21)(3,"ion-label")(4,"h2",22),t._uU(5),t.qZA()()(),t.TgZ(6,"ion-item",21)(7,"ion-label")(8,"h2",22),t._uU(9),t.qZA()()()()()),2&e){const i=t.oxw();t.xp6(5),t.hij("Sin Casco: ",i.counts[0].users_count," "),t.xp6(4),t.hij("Con Casco: ",i.counts[0].helmets_count," ")}}let I=(()=>{class e{constructor(i,n,r,N,F,J,E,_){this.auditoryService=i,this.loadingService=n,this.responseService=r,this.mapService=N,this.route=F,this.router=J,this.confirmDialogService=E,this.platformDownloadService=_,this.backUrl=(0,g.Ms)("remote"),this.auditoryId="0",this.auditoryTitle="",this.auditoryDate="",this.auditoryTime="",this.auditoryDescription="",this.auditoryCloseNote="",this.auditoryLat="",this.auditoryLng="",this.yesScore=0,this.notScore=0,this.auditoyrEvidences=[],this.auditorySections=[],this.counts=[]}ionViewWillEnter(){this.route.paramMap.subscribe({next:i=>{i.has("id")?(this.loadingService.showLoading(),this.auditoryId=i.get("id")||"0",this.auditoryService.getRemoteDetail(this.auditoryId).subscribe({next:n=>{this.setAuditory(n.data)},error:n=>this.responseService.onError(n,"No se pudo recuperar la auditor\xeda")})):this.router.navigateByUrl(this.backUrl)}}).unsubscribe()}setAuditory(i){this.auditoryTitle=i.title,this.auditoryDate=i.date,this.auditoryTime=i.time,this.auditoryDescription=i.description,this.auditoryCloseNote=i.close_note,this.auditoryLat=i.lat,this.auditoryLng=i.lng,this.auditoyrEvidences=i.evidences.map(n=>`${h.T0}/helmet/${n.dir}.jpeg`),this.counts=i.counts,this.mapService.setCenter(+this.auditoryLat,+this.auditoryLng,!0),setTimeout(()=>{this.loadingService.dismissLoading()},500)}downloadCsv(){this.confirmDialogService.presentAlert("\xbfDesea descargar en formato CSV?",()=>{const r=new Blob(["Tipo,conteo\n"+("Sin Casco,"+this.counts[0].users_count+"\nCon Casco,"+this.counts[0].helmets_count)],{type:"text/csv"});this.platformDownloadService.downloadBlob(r,this.auditoryTitle,"csv")})}downloadPdf(){this.confirmDialogService.presentAlert("\xbfDesea descargar en formato PDF?",()=>{this.loadingService.showLoading(),this.auditoryService.downloadPdf(this.auditoryId).subscribe({next:i=>(0,m.mG)(this,void 0,void 0,function*(){return this.platformDownloadService.downloadBlob(i,this.auditoryTitle,"pdf")}),error:i=>this.responseService.onError(i,"No se pudo descargar el archivo")})})}onGoingBack(){this.router.navigateByUrl(this.backUrl)}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(p.G),t.Y36(v.b),t.Y36(y.J),t.Y36(f.S),t.Y36(c.gz),t.Y36(c.F0),t.Y36(A.D),t.Y36(D.A))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-helmet-auditory-detail"]],decls:19,vars:7,consts:[[1,"row","mt-2","mx-0"],["class","col",4,"ngIf"],[1,"col","text-end"],["id","c1","size","small"],["slot","icon-only","name","cloud-download"],["trigger","c1","triggerAction","click",3,"dismissOnSelect"],[1,"mx-2","mt-4"],["class","mt-4",4,"ngIf"],[4,"ngIf"],["class","row",4,"ngIf"],[1,"col"],["size","small",3,"click"],["slot","icon-only","name","arrow-back-outline"],["lines","none"],["button","",3,"click"],[1,"mt-4"],[1,"mt-2"],["width","100%","class","mb-2",3,"src",4,"ngFor","ngForOf"],["width","100%",1,"mb-2",3,"src"],[1,"row"],[1,"col-12","p-4"],[1,"mt-2","txtInput","ion-no-padding","ion-no-margin"],[1,"text-start","ps-2"]],template:function(i,n){1&i&&(t.TgZ(0,"ion-content")(1,"div",0),t.YNc(2,Z,3,0,"div",1),t.TgZ(3,"div",2)(4,"ion-button",3),t._UZ(5,"ion-icon",4),t.qZA(),t.TgZ(6,"ion-popover",5),t.YNc(7,x,8,0,"ng-template"),t.qZA()()(),t.TgZ(8,"div",6)(9,"h1"),t._uU(10),t.qZA(),t.YNc(11,S,4,2,"p",7),t.YNc(12,P,4,1,"p",8),t.TgZ(13,"p")(14,"strong"),t._uU(15,"Ubicaci\xf3n:"),t.qZA(),t._UZ(16,"app-map"),t.qZA(),t.YNc(17,U,4,1,"p",8),t.YNc(18,C,10,2,"div",9),t.qZA()()),2&i&&(t.xp6(2),t.Q6J("ngIf",n.backUrl),t.xp6(4),t.Q6J("dismissOnSelect",!0),t.xp6(4),t.Oqu(n.auditoryTitle),t.xp6(1),t.Q6J("ngIf",n.auditoryDate),t.xp6(1),t.Q6J("ngIf",n.auditoryDescription),t.xp6(5),t.Q6J("ngIf",n.auditoyrEvidences.length>0),t.xp6(1),t.Q6J("ngIf",n.counts[0]))},dependencies:[l.sg,l.O5,a.YG,a.W2,a.gu,a.Ie,a.Q$,a.q_,a.d8,T.G],encapsulation:2}),e})();var Y=o(3375);const b=[{path:"",component:I}];let w=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[l.ez,u.u5,a.Pc,c.Bz.forChild(b),Y.R]}),e})()}}]);