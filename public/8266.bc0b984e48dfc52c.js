"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8266],{76:(y,v,n)=>{n.d(v,{GW:()=>r,dk:()=>c,oK:()=>e});var e=(()=>{return(l=e||(e={})).Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS",e;var l})(),r=(()=>{return(l=r||(r={})).Rear="REAR",l.Front="FRONT",r;var l})(),c=(()=>{return(l=c||(c={})).Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",c;var l})()},1443:(y,v,n)=>{n.d(v,{ez:()=>r,tP:()=>e});var e=(()=>{return(o=e||(e={})).Documents="DOCUMENTS",o.Data="DATA",o.Library="LIBRARY",o.Cache="CACHE",o.External="EXTERNAL",o.ExternalStorage="EXTERNAL_STORAGE",e;var o})(),r=(()=>{return(o=r||(r={})).UTF8="utf8",o.ASCII="ascii",o.UTF16="utf16",r;var o})()},1067:(y,v,n)=>{n.d(v,{ez:()=>r.ez,fy:()=>c,tP:()=>r.tP});var e=n(7423),r=n(1443);const c=(0,e.fo)("Filesystem",{web:()=>n.e(6364).then(n.bind(n,6364)).then(l=>new l.FilesystemWeb)})},6769:(y,v,n)=>{n.d(v,{$:()=>f});var e=n(8256),r=n(1433),c=n(6895),l=n(4731);function o(h,i){if(1&h){const s=e.EpF();e.TgZ(0,"div",3)(1,"ion-button",4),e.NdJ("click",function(){e.CHM(s);const u=e.oxw();return e.KtG(u.onGoingBack())}),e._UZ(2,"ion-icon",5),e.qZA()()}}function P(h,i){if(1&h){const s=e.EpF();e.TgZ(0,"div",6)(1,"ion-button",4),e.NdJ("click",function(){e.CHM(s);const u=e.oxw();return e.KtG(u.onGoingHome())}),e._UZ(2,"ion-icon",7),e.qZA()()}}function t(h,i){if(1&h){const s=e.EpF();e.TgZ(0,"div",6)(1,"ion-button",4),e.NdJ("click",function(){e.CHM(s);const u=e.oxw();return e.KtG(u.customButton.click())}),e._UZ(2,"ion-icon",8),e.qZA()()}if(2&h){const s=e.oxw();e.xp6(2),e.Q6J("name",s.customButton.icon)}}let f=(()=>{class h{constructor(s){this.router=s}ngOnInit(){}onGoingHome(){this.router.navigateByUrl(this.homeUrl)}onGoingBack(){this.router.navigateByUrl(this.backUrl)}}return h.\u0275fac=function(s){return new(s||h)(e.Y36(r.F0))},h.\u0275cmp=e.Xpm({type:h,selectors:[["app-header-buttons"]],inputs:{homeUrl:"homeUrl",backUrl:"backUrl",customButton:"customButton"},decls:4,vars:3,consts:[[1,"row","mt-2","mx-0"],["class","col",4,"ngIf"],["class","col text-end",4,"ngIf"],[1,"col"],["size","small",3,"click"],["slot","icon-only","name","arrow-back-outline"],[1,"col","text-end"],["slot","icon-only","name","home-sharp"],["slot","icon-only",3,"name"]],template:function(s,d){1&s&&(e.TgZ(0,"div",0),e.YNc(1,o,3,0,"div",1),e.YNc(2,P,3,0,"div",2),e.YNc(3,t,3,1,"div",2),e.qZA()),2&s&&(e.xp6(1),e.Q6J("ngIf",d.backUrl),e.xp6(1),e.Q6J("ngIf",d.homeUrl),e.xp6(1),e.Q6J("ngIf",d.customButton))},dependencies:[c.O5,l.YG,l.gu],encapsulation:2}),h})()},1576:(y,v,n)=>{n.d(v,{Y:()=>l});var e=n(6895),r=n(4731),c=n(8256);let l=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[e.ez,r.Pc]}),o})()},6280:(y,v,n)=>{n.d(v,{D:()=>l});var e=n(655),r=n(8256),c=n(4731);let l=(()=>{class o{constructor(t){this.alertController=t}presentAlert(t,f){return(0,e.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Confirmaci\xf3n",message:t,mode:"ios",buttons:[{text:"Cancelar",role:"cancel"},{text:"Aceptar",role:"confirm",handler:f}]})).present()})}}return o.\u0275fac=function(t){return new(t||o)(r.LFG(c.Br))},o.\u0275prov=r.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},6250:(y,v,n)=>{n.d(v,{T:()=>t});var e=n(655),r=n(7423),c=n(76);const l=(0,r.fo)("Camera",{web:()=>n.e(3954).then(n.bind(n,3954)).then(f=>new f.CameraWeb)});var o=n(1067),P=n(8256);let t=(()=>{class f{constructor(){this.takePicture=()=>(0,e.mG)(this,void 0,void 0,function*(){return yield l.getPhoto({quality:90,source:c.oK.Camera,resultType:c.dk.Uri})}),this.openGallery=()=>(0,e.mG)(this,void 0,void 0,function*(){return yield l.pickImages({quality:90,limit:1})}),this.convertBlobToBase64=i=>new Promise((s,d)=>{const u=new FileReader;u.onerror=d,u.onload=()=>{s(u.result)},u.readAsDataURL(i)})}saveLocalLogo(i){return(0,e.mG)(this,void 0,void 0,function*(){const s=yield this.readAsBase64(i);yield o.fy.writeFile({path:"logo.jpeg",data:s,directory:o.tP.Data})})}saveLocalAuditoryEvidence(i,s){return(0,e.mG)(this,void 0,void 0,function*(){const d=yield this.readAsBase64(i),u=`${s}-AUD${this.generateName()}`;return yield o.fy.writeFile({path:u,data:d,directory:o.tP.Data}),u})}saveLocalHelmetAuditoryEvidence(i,s){return(0,e.mG)(this,void 0,void 0,function*(){const d=yield this.readAsBase64(i),u=`${s}-HEL${this.generateName()}`;return yield o.fy.writeFile({path:u,data:d,directory:o.tP.Data}),u})}saveLocalBeltAuditoryEvidence(i,s){return(0,e.mG)(this,void 0,void 0,function*(){const d=`${s}-BEL${this.generateName()}`;return yield o.fy.writeFile({path:d,data:i,directory:o.tP.Data}),d})}saveLocalGeneralCountAuditoryEvidence(i,s){return(0,e.mG)(this,void 0,void 0,function*(){const d=`${s}-GCO${this.generateName()}`;return yield o.fy.writeFile({path:d,data:i,directory:o.tP.Data}),d})}saveLocalAnswerEvidence(i,s,d){return(0,e.mG)(this,void 0,void 0,function*(){const u=yield this.readAsBase64(i),E=`${s}-ANS${d}-${this.generateName()}`;return yield o.fy.writeFile({path:E,data:u,directory:o.tP.Data}),E})}getLocalAuditoryEvidence(i){return o.fy.readFile({path:i,encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalAuditoryEvidenceUri(i){return o.fy.getUri({path:i,directory:o.tP.Data})}getLocalAnswerEvidence(i){return o.fy.readFile({path:i,encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalAnswerEvidenceUri(i){return o.fy.getUri({path:i,directory:o.tP.Data})}removeLocalAuditoryEvidence(i){return o.fy.deleteFile({path:i,directory:o.tP.Data})}removeLocalAnswerEvidence(i){return o.fy.deleteFile({path:i,directory:o.tP.Data})}generateName(){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";let d="";for(let u=0;u<64;u++)d+=i.charAt(Math.floor(Math.random()*i.length));return`${d}.png`}getLocalLogo(){return o.fy.readFile({path:"logo.jpeg",encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalLogoUri(){return o.fy.getUri({path:"logo.jpeg",directory:o.tP.Data})}readAsBase64(i){return(0,e.mG)(this,void 0,void 0,function*(){return yield this.convertBlobToBase64(i)})}onTakePicture(i){return(0,e.mG)(this,void 0,void 0,function*(){})}}return f.\u0275fac=function(i){return new(i||f)},f.\u0275prov=P.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8266:(y,v,n)=>{n.r(v),n.d(v,{ProfilePageModule:()=>L});var e=n(6895),r=n(433),c=n(4731),l=n(655),o=n(7423),P=n(7368),t=n(8256),f=n(928),h=n(6250),i=n(2424),s=n(6280),d=n(2414),u=n(6572),E=n(1433),S=n(1481),C=n(6769);function D(m,A){if(1&m&&(t.TgZ(0,"ion-row",11)(1,"ion-col"),t._UZ(2,"img",15),t.qZA()()),2&m){const a=t.oxw(2);t.xp6(2),t.Q6J("src",a.ImageSafeSrc,t.LSH)}}function T(m,A){if(1&m){const a=t.EpF();t.TgZ(0,"form",3),t.NdJ("ngSubmit",function(){t.CHM(a);const p=t.oxw();return t.KtG(p.onSubmit())}),t.TgZ(1,"div",4)(2,"h1"),t._uU(3,"Mis Datos"),t.qZA(),t.TgZ(4,"ion-item",5)(5,"ion-label",6),t._uU(6,"Nombre completo"),t.qZA(),t._UZ(7,"ion-input",7),t.qZA(),t.TgZ(8,"ion-item",8)(9,"ion-label",6),t._uU(10,"N\xfamero de tel\xe9fono"),t.qZA(),t._UZ(11,"ion-input",9),t.qZA()(),t.YNc(12,D,3,1,"ion-row",10),t.TgZ(13,"ion-row",11)(14,"ion-col")(15,"ion-button",12),t.NdJ("click",function(){t.CHM(a);const p=t.oxw();return t.KtG(p.onSelectPhoto())}),t._uU(16),t.qZA()()(),t.TgZ(17,"ion-row",11)(18,"ion-col")(19,"ion-button",13),t.NdJ("click",function(){t.CHM(a);const p=t.oxw();return t.KtG(p.onGoingHome())}),t._uU(20," CANCELAR "),t.qZA()(),t.TgZ(21,"ion-col")(22,"ion-button",14),t._uU(23," ACTUALIZAR "),t.qZA()()()()}if(2&m){const a=t.oxw();t.Q6J("formGroup",a.form),t.xp6(7),t.Q6J("clearInput",!0),t.xp6(4),t.Q6J("clearInput",!0),t.xp6(1),t.Q6J("ngIf",a.ImageSafeSrc),t.xp6(4),t.hij(" ",a.ImageSafeSrc?"CAMBIAR LOGO":"SELECCIONAR LOGO"," ")}}let B=(()=>{class m{constructor(a,g,p,U,x,F,_,N,M){this.sessionService=a,this.photoService=g,this.loadingService=p,this.confirmDialogService=U,this.httpResponseService=x,this.validFormService=F,this.router=_,this.sanitization=N,this.platform=M,this.backUri=(0,P.CE)(),this.user={},this.txtButtonEnter="GUARDAR",this.ImageSrc="",this.ImageSafeSrc="",this.platform.backButton.subscribeWithPriority(9999,()=>{this.router.navigateByUrl(this.backUri)})}initForm(){this.form=new r.cw({name:new r.NI("",{validators:[r.kI.required]}),phoneNumber:new r.NI("",{validators:[r.kI.required]})})}setData(a){this.form.setValue({name:a.userName,phoneNumber:a.userPhone}),this.loadingService.dismissLoading()}ionViewWillEnter(){this.loadingService.showLoading(),this.initForm(),this.sessionService.getProfileFormData().subscribe({next:a=>this.setData(a),error:a=>this.httpResponseService.onError(a,"No se pudieron recuperar los datos")}),this.photoService.getLocalLogoUri().then(a=>{this.ImageSafeSrc=o.dV.convertFileSrc(a.uri)})}onSubmit(){this.validFormService.isValid(this.form,[])&&this.confirmDialogService.presentAlert("\xbfDesea guardar los cambios?",()=>{this.loadingService.showLoading(),this.sessionService.update({name:this.form.controls.name.value,phone_number:this.form.controls.phoneNumber.value}).subscribe({next:g=>(0,l.mG)(this,void 0,void 0,function*(){if(this.ImageSrc){const p=yield fetch(this.ImageSrc).then(U=>U.blob());this.sessionService.uploadLogo(p).subscribe({next:U=>(0,l.mG)(this,void 0,void 0,function*(){this.photoService.saveLocalLogo(p),this.httpResponseService.onSuccess("Actualizaci\xf3n exitosa")}),error:U=>{this.httpResponseService.onError(U,"No se pudo guardar la imagen")}})}else this.httpResponseService.onSuccess("Actualizaci\xf3n exitosa")}),error:g=>{this.httpResponseService.onError(g,"No se pudieron actualizar los datos")}})})}onGoingHome(){this.router.navigateByUrl(this.backUri)}onSelectPhoto(){this.photoService.openGallery().then(a=>(0,l.mG)(this,void 0,void 0,function*(){this.ImageSafeSrc=this.sanitization.bypassSecurityTrustUrl(a.photos[0].webPath),this.ImageSrc=a.photos[0].webPath}))}}return m.\u0275fac=function(a){return new(a||m)(t.Y36(f.m),t.Y36(h.T),t.Y36(i.b),t.Y36(s.D),t.Y36(d.J),t.Y36(u.i),t.Y36(E.F0),t.Y36(S.H7),t.Y36(c.t4))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-profile"]],decls:4,vars:3,consts:[[3,"backUrl","homeUrl"],[1,"principal","col-md-6","col-xl-12","mr-auto","mb-4"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"card-body","mx-2","mt-2"],[1,"mt-4","txtInput"],["position","stacked"],["formControlName","name","type","text","placeholder","Escriba su nombre",3,"clearInput"],[1,"mt-2","txtInput"],["formControlName","phoneNumber","type","tel","placeholder","8888888888",3,"clearInput"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["expand","full","type","button",3,"click"],["color","danger","expand","full",3,"click"],["expand","full","type","submit"],["width","100%",3,"src"]],template:function(a,g){1&a&&(t.TgZ(0,"ion-content"),t._UZ(1,"app-header-buttons",0),t.TgZ(2,"div",1),t.YNc(3,T,24,5,"form",2),t.qZA()()),2&a&&(t.xp6(1),t.Q6J("backUrl",g.backUri)("homeUrl",g.backUri),t.xp6(2),t.Q6J("ngIf",g.form))},dependencies:[e.O5,r._Y,r.JJ,r.JL,r.sg,r.u,c.YG,c.wI,c.W2,c.pK,c.Ie,c.Q$,c.Nd,c.j9,C.$],encapsulation:2}),m})();var I=n(1576);const b=[{path:"",component:B}];let L=(()=>{class m{}return m.\u0275fac=function(a){return new(a||m)},m.\u0275mod=t.oAB({type:m}),m.\u0275inj=t.cJS({imports:[e.ez,r.UX,c.Pc,E.Bz.forChild(b),I.Y]}),m})()}}]);