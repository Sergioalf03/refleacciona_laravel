"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7607],{7607:(L,p,u)=>{u.r(p),u.d(p,{QuestionFormPageModule:()=>R});var v=u(6895),f=u(433),c=u(7002),g=u(1433),m=u(655),e=u(8256),x=u(5757),I=u(2628),w=u(9071),b=u(6280),S=u(3269);let T=(()=>{class i{constructor(t){this.databaseService=t}localSave(t){const n=(new Date).toISOString();return this.databaseService.executeQuery(`\n      INSERT INTO answer_evidences (auditory_id, question_id, dir, creationDate)\n      VALUES (${t.auditoryId}, ${t.questionId}, "${t.dir}", "${n}");\n    `)}getEvidencesByAuditoryAndQuestion(t,n){return this.databaseService.executeQuery(`SELECT * FROM answer_evidences WHERE auditory_id = ${t} AND question_id = ${n};`)}getLastInsertedDir(){return this.databaseService.executeQuery("SELECT MAX(id) AS id, dir FROM answer_evidences LIMIT 1;")}localRemove(t){return this.databaseService.executeQuery(`DELETE FROM answer_evidences WHERE dir = "${t}";`)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(S.k))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var F=u(2414),Q=u(6769);function P(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",19)(1,"ion-input",20),e.NdJ("ionChange",function(o){e.CHM(t);const s=e.oxw(),d=s.$implicit,a=s.index,l=e.oxw(2);return e.KtG(l.onAnswerChange(o,d,a))}),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("autofocus",!0)("clearInput",!0)("autocomplete",!0)("value",t.answer)}}function y(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-input",22),e.NdJ("ionChange",function(o){e.CHM(t);const s=e.oxw(2),d=s.$implicit,a=s.index,l=e.oxw(2);return e.KtG(l.onAnswerChange(o,d,a))}),e.qZA()}if(2&i){const t=e.oxw(2).$implicit;e.Q6J("autofocus",!0)("clearInput",!0)("autocomplete",!0)("value",t.answer)}}function A(i,r){if(1&i&&(e.TgZ(0,"ion-item",19),e.YNc(1,y,1,4,"ion-input",21),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf","ONEDIGIT"===t.answers)}}function E(i,r){if(1&i&&(e.TgZ(0,"ion-radio",26),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.v),e.xp6(1),e.Oqu(t.t)}}function Z(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",23)(1,"ion-radio-group",24),e.NdJ("ionChange",function(o){e.CHM(t);const s=e.oxw(),d=s.$implicit,a=s.index,l=e.oxw(2);return e.KtG(l.onAnswerChange(o,d,a))}),e.YNc(2,E,2,2,"ion-radio",25),e._UZ(3,"br"),e.qZA()()}if(2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("value",+t.answer),e.xp6(1),e.Q6J("ngForOf",n.jsonCast(t.answers))}}function N(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(),s=o.index,d=o.$implicit,a=e.oxw(2);return e.KtG(a.onSelectPhoto(s,d.id))}),e._UZ(1,"ion-icon",28),e.qZA()}if(2&i){const t=e.oxw().index,n=e.oxw(2);e.Q6J("disabled",!n.ImageSrc[t].canTakePickture||!!n.ImageSrc[t].url)}}function C(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openedPopover=o.indx)}),e._UZ(1,"ion-icon",30),e.qZA()}}function q(i,r){if(1&i&&(e.TgZ(0,"ion-content",31),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.popup)}}function J(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row",32)(1,"ion-col")(2,"ion-img",33),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().index,s=e.oxw(2);return e.KtG(s.onImgClicked(o))}),e.qZA()()()}if(2&i){const t=e.oxw().index,n=e.oxw(2);e.xp6(2),e.Q6J("src",n.ImageSrc[t].url)}}function k(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"div"),e._uU(3),e.YNc(4,P,2,4,"ion-item",12),e.YNc(5,A,2,1,"ion-item",12),e.YNc(6,Z,4,2,"ion-item",13),e.qZA(),e.TgZ(7,"div",14),e.YNc(8,N,2,1,"ion-button",15),e.YNc(9,C,2,0,"ion-button",16),e.TgZ(10,"ion-popover",17),e.NdJ("didDismiss",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.openedPopover=0)}),e.YNc(11,q,2,1,"ng-template"),e.qZA()()(),e.YNc(12,J,3,1,"ion-row",18),e.qZA()}if(2&i){const t=r.$implicit,n=r.index,o=e.oxw(2);e.xp6(2),e.Tol(t.popup||t.has_evidence?"col-10":"col ion-text-justify"),e.xp6(1),e.hij(" ",t.uid+".- "+t.sentence," "),e.xp6(1),e.Q6J("ngIf","FREETEXT"===t.answers),e.xp6(1),e.Q6J("ngIf","ONEDIGIT"===t.answers),e.xp6(1),e.Q6J("ngIf","FREETEXT"!==t.answers&&"ONEDIGIT"!==t.answers),e.xp6(2),e.Q6J("ngIf",t.has_evidence),e.xp6(1),e.Q6J("ngIf",t.popup),e.xp6(1),e.Q6J("isOpen",o.openedPopover===t.indx),e.xp6(2),e.Q6J("ngIf",o.ImageSrc[n].url)}}function G(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,k,13,10,"div",9),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.questions)}}function Y(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",34),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onPrevious())}),e._uU(1,"ANTERIOR"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.loading)}}function $(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",34),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onNext())}),e._uU(1,"SIGUIENTE"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",!t.alreadyAnsweredAll()||t.loading)}}function O(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",34),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onFinish())}),e._uU(1,"FINALIZAR"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",!t.alreadyAnsweredAll()||t.loading)}}const U=[{path:"",component:(()=>{class i{constructor(t,n,o,s,d,a,l,_,h){this.questionService=t,this.answerService=n,this.route=o,this.router=s,this.photoService=d,this.confirmDialogService=a,this.answerEvidenceService=l,this.responseService=_,this.actionSheetCtrl=h,this.auditoryId="0",this.sectionId="0",this.sectionName="",this.subsectionName="",this.openedPopover=0,this.questions=[],this.ImageSrc=[],this.answerCount=0,this.loading=!1}ngOnInit(){this.route.paramMap.subscribe({next:t=>{(!t.has("sectionId")||!t.has("auditoryId"))&&this.router.navigateByUrl("/home"),this.auditoryId=`${t.get("auditoryId")}`,this.sectionId=`${t.get("sectionId")}`,this.fetchSection()}})}ionViewWillEnter(){}onNext(){"7"!==this.sectionId&&(this.sectionId=""+(+this.sectionId+1),this.fetchSection())}onPrevious(){"1"!==this.sectionId&&(this.sectionId=""+(+this.sectionId-1),this.fetchSection())}fetchSection(){this.questionService.getSection(this.sectionId).subscribe({next:t=>{if("waiting"!==t){this.loading=!0;const n=t.values[0];this.sectionName=n.name,this.subsectionName=n.subname,this.questionService.getLocalQuestionsBySection(this.sectionId,this.auditoryId).subscribe({next:o=>{"waiting"!==o&&(this.questions=o.values,this.ImageSrc=this.questions.map(s=>({canTakePickture:!!s.answer,url:"",id:s.dir?s.dir:""})),this.ImageSrc.forEach((s,d)=>{s.id&&this.photoService.getLocalAnswerEvidence(s.id).then(a=>{this.ImageSrc[d].url="data:image/jpeg;base64,"+a.data})}),this.loading=!1)}})}}})}jsonCast(t){return JSON.parse(t)}onSelectPhoto(t,n){return(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.actionSheetCtrl.create({header:"Opciones",mode:"ios",buttons:[{text:"C\xe1mara",handler:()=>this.fromCamera(t,n)},{text:"Galer\xeda",handler:()=>this.fromGallery(t,n)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}]})).present()})}fromGallery(t,n){this.photoService.openGallery().then(o=>(0,m.mG)(this,void 0,void 0,function*(){for(let s=0;s<o.photos.length;s++){const d=o.photos[s].webPath,a=yield fetch(d).then(l=>l.blob());this.photoService.saveLocalAnswerEvidence(a,this.auditoryId).then(l=>{this.answerEvidenceService.localSave({auditoryId:this.auditoryId,questionId:n,dir:l}).subscribe({next:_=>(0,m.mG)(this,void 0,void 0,function*(){"waiting"!==_&&this.answerEvidenceService.getLastInsertedDir().subscribe({next:h=>(0,m.mG)(this,void 0,void 0,function*(){"waiting"!==h&&(this.ImageSrc[t].url=d,this.ImageSrc[t].id=h.values[0].dir)})})}),error:_=>{this.responseService.onError(_,"No se pudo guardar una imagen")}})})}}))}fromCamera(t,n){this.photoService.takePicture().then(o=>(0,m.mG)(this,void 0,void 0,function*(){const s=o.webPath||"",d=yield fetch(s).then(a=>a.blob());this.photoService.saveLocalAnswerEvidence(d,this.auditoryId).then(a=>{this.answerEvidenceService.localSave({auditoryId:this.auditoryId,questionId:n,dir:a}).subscribe({next:l=>(0,m.mG)(this,void 0,void 0,function*(){"waiting"!==l&&this.answerEvidenceService.getLastInsertedDir().subscribe({next:_=>(0,m.mG)(this,void 0,void 0,function*(){"waiting"!==_&&(this.ImageSrc[t].url=s,this.ImageSrc[t].id=_.values[0].dir)})})}),error:l=>{this.responseService.onError(l,"No se pudo guardar una imagen")}})})}))}onImgClicked(t){this.confirmDialogService.presentAlert("\xbfDesea eliminar la imagen?",()=>{this.photoService.removeLocalAnswerEvidence(this.ImageSrc[t].id).then(()=>{this.ImageSrc[t]={canTakePickture:!0,url:"",id:""}})})}onAnswerChange(t,n,o){t.detail.value?this.answerService.saveAnswer(n.id,this.auditoryId,t.detail.value).subscribe({next:s=>{this.ImageSrc[o].canTakePickture=!0}}):this.ImageSrc[o].canTakePickture=!1}alreadyAnsweredAll(){return this.answerCount=0,this.ImageSrc.every(t=>(t.canTakePickture&&this.answerCount++,t.canTakePickture))}onFinish(){this.router.navigateByUrl(`/auditory-finish-form/${this.auditoryId}`)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(x.a),e.Y36(I.P),e.Y36(g.gz),e.Y36(g.F0),e.Y36(w.T),e.Y36(b.D),e.Y36(T),e.Y36(F.J),e.Y36(c.BX))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-question-form"]],decls:22,vars:8,consts:[[1,"ion-no-border"],["backUrl","/home","homeUrl","/home"],[1,"principal","col-md-6","col-xl-12","mr-auto","mb-4"],[1,"mx-2","mt-2"],[1,"text-center"],[1,"ion-padding-horizontal"],[4,"ngIf"],[1,"mt-2"],["expand","full",3,"disabled","click",4,"ngIf"],["class","mt-2 mb-2",4,"ngFor","ngForOf"],[1,"mt-2","mb-2"],[1,"row"],["class","txtInput",4,"ngIf"],["lines","none",4,"ngIf"],[1,"col-2"],["size","small",3,"disabled","click",4,"ngIf"],["size","small",3,"click",4,"ngIf"],[3,"isOpen","didDismiss"],["class","mt-3",4,"ngIf"],[1,"txtInput"],[3,"autofocus","clearInput","autocomplete","value","ionChange"],["maxlength","1","type","number",3,"autofocus","clearInput","autocomplete","value","ionChange",4,"ngIf"],["maxlength","1","type","number",3,"autofocus","clearInput","autocomplete","value","ionChange"],["lines","none"],[1,"ion-no-border",3,"value","ionChange"],["justify","start","label-placement","end","mode","md",3,"value",4,"ngFor","ngForOf"],["justify","start","label-placement","end","mode","md",3,"value"],["size","small",3,"disabled","click"],["slot","icon-only","name","camera",2,"font-size","15px"],["size","small",3,"click"],["slot","icon-only","name","help",2,"font-size","15px"],[1,"ion-padding","ion-text-justify"],[1,"mt-3"],[3,"src","click"],["expand","full",3,"disabled","click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header",0),e._UZ(1,"app-header-buttons",1),e.TgZ(2,"div",2)(3,"div",3)(4,"h5",4),e._uU(5),e.qZA(),e.TgZ(6,"h6",4),e._uU(7),e.qZA()()()(),e.TgZ(8,"ion-content",5),e.YNc(9,G,2,1,"div",6),e.qZA(),e.TgZ(10,"ion-footer")(11,"ion-row",7)(12,"ion-col")(13,"p",4)(14,"strong"),e._uU(15),e.qZA()()()(),e.TgZ(16,"ion-row")(17,"ion-col"),e.YNc(18,Y,2,1,"ion-button",8),e.qZA(),e.TgZ(19,"ion-col"),e.YNc(20,$,2,1,"ion-button",8),e.YNc(21,O,2,1,"ion-button",8),e.qZA()()()),2&t&&(e.xp6(5),e.Oqu(n.sectionName),e.xp6(2),e.Oqu(n.subsectionName),e.xp6(2),e.Q6J("ngIf",!n.loading),e.xp6(6),e.AsE(" ",n.answerCount,"/",n.questions.length," Respuestas"),e.xp6(3),e.Q6J("ngIf","1"!==n.sectionId),e.xp6(2),e.Q6J("ngIf","7"!==n.sectionId),e.xp6(1),e.Q6J("ngIf","7"===n.sectionId))},dependencies:[v.sg,v.O5,c.YG,c.wI,c.W2,c.fr,c.Gu,c.gu,c.Xz,c.pK,c.Ie,c.B7,c.se,c.Nd,c.d8,c.as,c.U5,c.QI,c.j9,Q.$],encapsulation:2}),i})()}];let M=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[g.Bz.forChild(U),g.Bz]}),i})();var D=u(1576);let R=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[v.ez,f.UX,c.Pc,M,D.Y]}),i})()}}]);