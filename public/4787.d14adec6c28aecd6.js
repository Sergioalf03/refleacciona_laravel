"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4787],{76:(U,p,r)=>{r.d(p,{GW:()=>c,dk:()=>m,oK:()=>i});var i=(()=>{return(l=i||(i={})).Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS",i;var l})(),c=(()=>{return(l=c||(c={})).Rear="REAR",l.Front="FRONT",c;var l})(),m=(()=>{return(l=m||(m={})).Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",m;var l})()},1443:(U,p,r)=>{r.d(p,{ez:()=>c,tP:()=>i});var i=(()=>{return(o=i||(i={})).Documents="DOCUMENTS",o.Data="DATA",o.Library="LIBRARY",o.Cache="CACHE",o.External="EXTERNAL",o.ExternalStorage="EXTERNAL_STORAGE",i;var o})(),c=(()=>{return(o=c||(c={})).UTF8="utf8",o.ASCII="ascii",o.UTF16="utf16",c;var o})()},1067:(U,p,r)=>{r.d(p,{ez:()=>c.ez,fy:()=>m,tP:()=>c.tP});var i=r(7423),c=r(1443);const m=(0,i.fo)("Filesystem",{web:()=>r.e(6364).then(r.bind(r,6364)).then(l=>new l.FilesystemWeb)})},6769:(U,p,r)=>{r.d(p,{$:()=>y});var i=r(8256),c=r(1433),m=r(6895),l=r(4731);function o(f,s){if(1&f){const a=i.EpF();i.TgZ(0,"div",3)(1,"ion-button",4),i.NdJ("click",function(){i.CHM(a);const d=i.oxw();return i.KtG(d.onGoingBack())}),i._UZ(2,"ion-icon",5),i.qZA()()}}function t(f,s){if(1&f){const a=i.EpF();i.TgZ(0,"div",6)(1,"ion-button",4),i.NdJ("click",function(){i.CHM(a);const d=i.oxw();return i.KtG(d.onGoingHome())}),i._UZ(2,"ion-icon",7),i.qZA()()}}function P(f,s){if(1&f){const a=i.EpF();i.TgZ(0,"div",6)(1,"ion-button",4),i.NdJ("click",function(){i.CHM(a);const d=i.oxw();return i.KtG(d.customButton.click())}),i._UZ(2,"ion-icon",8),i.qZA()()}if(2&f){const a=i.oxw();i.xp6(2),i.Q6J("name",a.customButton.icon)}}let y=(()=>{class f{constructor(a){this.router=a}ngOnInit(){}onGoingHome(){this.router.navigateByUrl(this.homeUrl)}onGoingBack(){this.router.navigateByUrl(this.backUrl)}}return f.\u0275fac=function(a){return new(a||f)(i.Y36(c.F0))},f.\u0275cmp=i.Xpm({type:f,selectors:[["app-header-buttons"]],inputs:{homeUrl:"homeUrl",backUrl:"backUrl",customButton:"customButton"},decls:4,vars:3,consts:[[1,"row","mt-2","mx-0"],["class","col",4,"ngIf"],["class","col text-end",4,"ngIf"],[1,"col"],["size","small",3,"click"],["slot","icon-only","name","arrow-back-outline"],[1,"col","text-end"],["slot","icon-only","name","home-sharp"],["slot","icon-only",3,"name"]],template:function(a,u){1&a&&(i.TgZ(0,"div",0),i.YNc(1,o,3,0,"div",1),i.YNc(2,t,3,0,"div",2),i.YNc(3,P,3,1,"div",2),i.qZA()),2&a&&(i.xp6(1),i.Q6J("ngIf",u.backUrl),i.xp6(1),i.Q6J("ngIf",u.homeUrl),i.xp6(1),i.Q6J("ngIf",u.customButton))},dependencies:[m.O5,l.YG,l.gu],encapsulation:2}),f})()},1576:(U,p,r)=>{r.d(p,{Y:()=>l});var i=r(6895),c=r(4731),m=r(8256);let l=(()=>{class o{}return o.\u0275fac=function(P){return new(P||o)},o.\u0275mod=m.oAB({type:o}),o.\u0275inj=m.cJS({imports:[i.ez,c.Pc]}),o})()},6250:(U,p,r)=>{r.d(p,{T:()=>P});var i=r(655),c=r(7423),m=r(76);const l=(0,c.fo)("Camera",{web:()=>r.e(3954).then(r.bind(r,3954)).then(y=>new y.CameraWeb)});var o=r(1067),t=r(8256);let P=(()=>{class y{constructor(){this.takePicture=()=>(0,i.mG)(this,void 0,void 0,function*(){return yield l.getPhoto({quality:90,source:m.oK.Camera,resultType:m.dk.Uri})}),this.openGallery=()=>(0,i.mG)(this,void 0,void 0,function*(){return yield l.pickImages({quality:90,limit:1})}),this.convertBlobToBase64=s=>new Promise((a,u)=>{const d=new FileReader;d.onerror=u,d.onload=()=>{a(d.result)},d.readAsDataURL(s)})}saveLocalLogo(s){return(0,i.mG)(this,void 0,void 0,function*(){const a=yield this.readAsBase64(s);yield o.fy.writeFile({path:"logo.jpeg",data:a,directory:o.tP.Data})})}saveLocalAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const u=yield this.readAsBase64(s),d=`${a}-AUD${this.generateName()}`;return yield o.fy.writeFile({path:d,data:u,directory:o.tP.Data}),d})}saveLocalHelmetAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const u=yield this.readAsBase64(s),d=`${a}-HEL${this.generateName()}`;return yield o.fy.writeFile({path:d,data:u,directory:o.tP.Data}),d})}saveLocalBeltAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const u=`${a}-BEL${this.generateName()}`;return yield o.fy.writeFile({path:u,data:s,directory:o.tP.Data}),u})}saveLocalGeneralCountAuditoryEvidence(s,a){return(0,i.mG)(this,void 0,void 0,function*(){const u=`${a}-GCO${this.generateName()}`;return yield o.fy.writeFile({path:u,data:s,directory:o.tP.Data}),u})}saveLocalAnswerEvidence(s,a,u){return(0,i.mG)(this,void 0,void 0,function*(){const d=yield this.readAsBase64(s),T=`${a}-ANS${u}-${this.generateName()}`;return yield o.fy.writeFile({path:T,data:d,directory:o.tP.Data}),T})}getLocalAuditoryEvidence(s){return o.fy.readFile({path:s,encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalAuditoryEvidenceUri(s){return o.fy.getUri({path:s,directory:o.tP.Data})}getLocalAnswerEvidence(s){return o.fy.readFile({path:s,encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalAnswerEvidenceUri(s){return o.fy.getUri({path:s,directory:o.tP.Data})}removeLocalAuditoryEvidence(s){return o.fy.deleteFile({path:s,directory:o.tP.Data})}removeLocalAnswerEvidence(s){return o.fy.deleteFile({path:s,directory:o.tP.Data})}generateName(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";let u="";for(let d=0;d<64;d++)u+=s.charAt(Math.floor(Math.random()*s.length));return`${u}.png`}getLocalLogo(){return o.fy.readFile({path:"logo.jpeg",encoding:o.ez.UTF8,directory:o.tP.Data})}getLocalLogoUri(){return o.fy.getUri({path:"logo.jpeg",directory:o.tP.Data})}readAsBase64(s){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.convertBlobToBase64(s)})}onTakePicture(s){return(0,i.mG)(this,void 0,void 0,function*(){})}}return y.\u0275fac=function(s){return new(s||y)},y.\u0275prov=t.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},4787:(U,p,r)=>{r.r(p),r.d(p,{BeltAuditoryListPageModule:()=>R});var i=r(6895),c=r(4731),m=r(655),l=r(313),o=r(7368),t=r(8256),P=r(8022),y=r(8920),f=r(3863),s=r(6250),a=r(2414),u=r(2424),d=r(1433),T=r(6280),C=r(6769);function F(h,L){if(1&h){const e=t.EpF();t.TgZ(0,"div",5)(1,"h4",6),t._uU(2,"Sin conteos"),t.qZA(),t.TgZ(3,"ion-button",7),t.NdJ("click",function(){t.CHM(e);const v=t.oxw();return t.KtG(v.onNewAuditory())}),t._uU(4,"Iniciar uno nuevo"),t.qZA()()}}function N(h,L){if(1&h&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&h){const e=t.oxw().$implicit;t.xp6(1),t.hij("Fecha: ",e.date,"")}}function O(h,L){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",12),t.NdJ("click",function(){t.CHM(e);const v=t.oxw().$implicit,_=t.oxw();return t.KtG(_.presentActionSheetOptions(v))}),t._UZ(1,"ion-icon",13),t.qZA()}}function I(h,L){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",12),t.NdJ("click",function(){t.CHM(e);const v=t.oxw().$implicit,_=t.oxw();return t.KtG(_.onRemoteDetail(v.id))}),t._UZ(1,"ion-icon",14),t.qZA()}}function Z(h,L){if(1&h&&(t.TgZ(0,"ion-item",8)(1,"ion-label")(2,"h2",9),t._uU(3),t.qZA(),t.YNc(4,N,2,1,"p",10),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.YNc(7,O,2,0,"ion-button",11),t.YNc(8,I,2,0,"ion-button",11),t.qZA()),2&h){const e=L.$implicit,n=t.oxw();t.xp6(3),t.hij("T\xedtulo: ",e.title,""),t.xp6(1),t.Q6J("ngIf",e.date),t.xp6(2),t.hij("Estado: ",e.statusWord,""),t.xp6(1),t.Q6J("ngIf",!n.sendedList),t.xp6(1),t.Q6J("ngIf",n.sendedList)}}let M=(()=>{class h{constructor(e,n,v,_,A,E,g,B,D,x,S){this.auditoryService=e,this.auditoryEvidenceService=n,this.helmetCollectionService=v,this.photoService=_,this.responseService=A,this.loadingService=E,this.router=g,this.confirmDialogService=B,this.actionSheetCtrl=D,this.route=x,this.platform=S,this.auditories=[],this.sendedList=!1,this.loading=!1,this.customButton={click:()=>this.router.navigateByUrl(this.formUri),icon:"add"},this.backUri=(0,o.CE)(),this.formUri=(0,o.YB)("00"),this.platform.backButton.subscribeWithPriority(9999,()=>{this.router.navigateByUrl(this.backUri)})}ionViewWillEnter(){return(0,m.mG)(this,void 0,void 0,function*(){this.route.paramMap.subscribe({next:e=>{e.has("origin")?"remote"===e.get("origin")?this.fetchRemoteList():this.fetchLocalList():this.router.navigateByUrl(this.backUri)}}).unsubscribe()})}onGoingHome(){this.router.navigateByUrl(this.backUri)}onEdit(e){this.router.navigateByUrl((0,o.YB)(e))}onNewAuditory(){this.router.navigateByUrl((0,o.YB)("00"))}onUpload(e){this.confirmDialogService.presentAlert("Una vez enviado el registro no se podr\xe1 modificar. \xbfDesea continuar?",()=>{this.loadingService.showLoading(),this.auditoryService.getUpdateData(e).subscribe({next:n=>{n!==l.W&&setTimeout(()=>{this.helmetCollectionService.getList(e).subscribe({next:v=>{if(v!==l.W){const _={title:n.values[0].title,description:n.values[0].description,close_note:n.values[0].close_note,date:n.values[0].date,time:n.values[0].time,lat:n.values[0].lat,lng:n.values[0].lng,status:n.values[0].status,creation_date:n.values[0].creation_date,update_date:n.values[0].update_date,external_id:n.values[0].id,user_id:n.values[0].user_id},A=v.values.map(g=>({adults_count:g.adults_count,belt_auditory_id:g.belt_auditory_id,belts_count:g.belts_count,chairs_count:g.chairs_count,child_count:g.child_count,coopilot:g.coopilot,creation_date:g.creation_date,destination:g.destination,origin:g.origin,vehicle_type:1,overuse_count:g.overuse_count}));this.auditoryService.upload({auditory:_,counts:A}).subscribe({next:g=>{const B=g.data.id;this.auditoryService.updateExternalId(e,B).subscribe({next:D=>{D!==l.W&&setTimeout(()=>{this.uploadAuditoryPhotos(e,B)},20)}})},error:g=>this.responseService.onError(g,"No se pudo subir la auditor\xeda")})}}})},20)}})})}uploadAuditoryPhotos(e,n){this.auditoryEvidenceService.getEvidencesByAuditory(e).subscribe({next:v=>(0,m.mG)(this,void 0,void 0,function*(){v!==l.W&&this.uploadAuditoryEvidence(v.values,0,n).then(_=>{this.auditoryService.finalDelete(e).subscribe({next:A=>{A!==l.W&&(this.responseService.onSuccess("Auditor\xeda enviada exit\xf3samente"),setTimeout(()=>{this.fetchLocalList()},100))}})})})})}uploadAuditoryEvidence(e,n,v){return(0,m.mG)(this,void 0,void 0,function*(){return new Promise((A,E)=>(0,m.mG)(this,void 0,void 0,function*(){if(n===e.length)return A(!0);const g=yield this.photoService.getLocalAuditoryEvidence(e[n].dir).then(b=>b.data),B=g.split(",")[0].split(":")[1].split(";")[0],D=new ArrayBuffer(g.length),x=new Uint8Array(D);for(let b=0;b<B.length;b++)x[b]=B.charCodeAt(b);const S=new Blob([D],{type:B});this.auditoryEvidenceService.uploadImage(S,v,e[n].creation_date,e[n].dir).subscribe({next:()=>{this.photoService.removeLocalAuditoryEvidence(e[n].dir).then(()=>{this.auditoryEvidenceService.localRemove(e[n].dir).subscribe({next:b=>{b!==l.W&&this.uploadAuditoryEvidence(e,n+1,v).then(Y=>A(Y))}})})},error:b=>this.responseService.onError(b,"No se pudo subir la imagen")})}))})}onDelete(e){this.confirmDialogService.presentAlert("\xbfDesea eliminar el registro?",()=>{this.loadingService.showLoading(),this.auditoryService.deleteLocal(e).subscribe({next:n=>{n!==l.W&&(this.responseService.onSuccess("registro eliminado"),setTimeout(()=>{this.fetchLocalList()},100))},error:n=>{this.responseService.onError(n,"No se pudo eliminar el registro")}})})}onDetail(e){this.router.navigateByUrl((0,o.KC)(e))}onRemoteDetail(e){this.router.navigateByUrl((0,o.ah)(e))}onDownloadPdf(e,n){this.confirmDialogService.presentAlert("\xbfDesea descargar el registro?",()=>{this.loadingService.showLoading(),this.auditoryService.downloadPdf(e).subscribe({next:v=>{const _=v,A="data.pdf";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(_,A);else{const E=window.document.createElement("a");E.href=window.URL.createObjectURL(new Blob([_],{type:"application/pdf"})),E.download=A,document.body.appendChild(E),E.click(),document.body.removeChild(E)}},error:v=>this.responseService.onError(v,"No se pudo descargar la auditor\xeda")})})}presentActionSheetOptions(e){return(0,m.mG)(this,void 0,void 0,function*(){const n=this.sendedList?[{text:"Ver Conteo",handler:()=>this.onRemoteDetail(e.id)},{text:"Descargar Conteo",handler:()=>this.onDownloadPdf(e.id,e.title)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}]:e.countId?[{text:"Env\xedar Conteo",handler:()=>this.onUpload(e.id)},{text:"Actualizar Conteo",handler:()=>this.onDetail(e.id)},{text:"Actualizar datos generales",handler:()=>this.onEdit(e.id)},{text:"Eliminar Conteo",role:"destructive",handler:()=>this.onDelete(e.id)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}]:[{text:"Actualizar Conteo",handler:()=>this.onDetail(e.id)},{text:"Actualizar datos generales",handler:()=>this.onEdit(e.id)},{text:"Eliminar Conteo",role:"destructive",handler:()=>this.onDelete(e.id)},{text:"Cerrar",role:"cancel",data:{action:"cancel"}}];yield(yield this.actionSheetCtrl.create({header:"Opciones",mode:"ios",buttons:n})).present()})}fetchLocalList(){this.sendedList=!1,this.loadingService.showLoading(),this.loading=!0,this.auditoryService.getLocalList().subscribe({next:e=>{e!==l.W&&(this.auditories=e.map(n=>Object.assign(Object.assign({},n),{statusWord:1===n.status?"En progreso":"Terminada"})),this.loading=!1,this.loadingService.dismissLoading())},error:e=>{this.responseService.onError(e,"No se pudieron recuperar las auditor\xedas")}})}fetchRemoteList(){this.sendedList=!0,this.loadingService.showLoading(),this.auditoryService.getRemoteList().subscribe({next:e=>{this.sendedList=!0,this.auditories=e.data.map(n=>Object.assign(Object.assign({},n),{statusWord:"Enviado"})),this.loadingService.dismissLoading()},error:e=>{this.responseService.onError(e,"No se pudieron recuperar las auditor\xedas"),this.fetchLocalList()}})}}return h.\u0275fac=function(e){return new(e||h)(t.Y36(P.E),t.Y36(y.G),t.Y36(f.P),t.Y36(s.T),t.Y36(a.J),t.Y36(u.b),t.Y36(d.F0),t.Y36(T.D),t.Y36(c.BX),t.Y36(d.gz),t.Y36(c.t4))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-belt-auditory-list"]],decls:15,vars:6,consts:[[3,"customButton","backUrl"],[1,"mx-2","mt-2"],["class","text-center",4,"ngIf"],["class","mt-2 txtInput",4,"ngFor","ngForOf"],["expand","full",3,"disabled","click"],[1,"text-center"],[1,"mt-2"],[3,"click"],[1,"mt-2","txtInput"],[1,"text-start"],[4,"ngIf"],["slot","end","size","small",3,"click",4,"ngIf"],["slot","end","size","small",3,"click"],["slot","icon-only","name","menu"],["slot","icon-only","name","eye"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content"),t._UZ(1,"app-header-buttons",0),t.TgZ(2,"div",1)(3,"h1"),t._uU(4,"Uso de cintur\xf3n"),t.qZA(),t.YNc(5,F,5,0,"div",2),t.YNc(6,Z,9,5,"ion-item",3),t.qZA()(),t.TgZ(7,"ion-footer")(8,"ion-row")(9,"ion-col")(10,"ion-button",4),t.NdJ("click",function(){return n.fetchLocalList()}),t._uU(11,"SIN ENVIAR"),t.qZA()(),t.TgZ(12,"ion-col")(13,"ion-button",4),t.NdJ("click",function(){return n.fetchRemoteList()}),t._uU(14,"ENVIADAS"),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("customButton",n.customButton)("backUrl",n.backUri),t.xp6(4),t.Q6J("ngIf",!n.loading&&0===n.auditories.length),t.xp6(1),t.Q6J("ngForOf",n.auditories),t.xp6(4),t.Q6J("disabled",!n.sendedList),t.xp6(3),t.Q6J("disabled",n.sendedList))},dependencies:[i.sg,i.O5,c.YG,c.wI,c.W2,c.fr,c.gu,c.Ie,c.Q$,c.Nd,C.$],encapsulation:2}),h})();var G=r(1576);const w=[{path:"",component:M}];let R=(()=>{class h{}return h.\u0275fac=function(e){return new(e||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[i.ez,c.Pc,d.Bz.forChild(w),G.Y]}),h})()}}]);