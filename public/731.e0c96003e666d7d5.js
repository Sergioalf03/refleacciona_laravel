"use strict";(self.webpackChunkCallesMasSeguras=self.webpackChunkCallesMasSeguras||[]).push([[731],{3731:(Y,v,s)=>{s.r(v),s.d(v,{HelmetDetailModule:()=>F});var m=s(6814),g=s(5861),f=s(553),d=s(8433),e=s(9212),x=s(2354),p=s(594),C=s(677),w=s(5066),Z=s(9051),b=s(2634),u=s(9032),T=s(4237),h=s(2150),r=s(2500);const S=["slickModal"];function D(i,a){if(1&i&&e._UZ(0,"div",26),2&i){const t=e.oxw();e.Q6J("leafletOptions",t.markers)("leafletLayers",t.layers)}}function y(i,a){if(1&i&&(e.TgZ(0,"div",36)(1,"div",37),e._UZ(2,"img",38),e.qZA()()),2&i){const t=a.$implicit;e.xp6(2),e.s9C("src",t,e.LSH)}}function _(i,a){if(1&i&&(e.TgZ(0,"div",39)(1,"div",40),e._UZ(2,"img",38),e.qZA()()),2&i){const t=a.$implicit;e.xp6(2),e.s9C("src",t,e.LSH)}}function A(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",27)(1,"h5",25),e._uU(2,"Entorno"),e.qZA(),e.TgZ(3,"div",28)(4,"ngx-slick-carousel",29,30),e.YNc(6,y,3,1,"div",31),e.qZA(),e.TgZ(7,"div",32),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.nextSlide())}),e.qZA(),e.TgZ(8,"div",33),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.previousSlide())}),e.qZA(),e.TgZ(9,"ngx-slick-carousel",34),e.YNc(10,_,3,1,"div",35),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(4),e.Q6J("config",t.slideConfig),e.xp6(2),e.Q6J("ngForOf",t.evidences),e.xp6(3),e.Q6J("config",t.slidesConfig),e.xp6(),e.Q6J("ngForOf",t.evidences)}}function k(i,a){1&i&&(e.TgZ(0,"div",41)(1,"span",42),e._uU(2,"Loading..."),e.qZA()())}function I(i,a){1&i&&(e.TgZ(0,"span",43),e._UZ(1,"i",44),e.qZA())}function H(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",45)(1,"a",46),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.downloadPdf())}),e._uU(2,"Descargar PDF"),e.qZA(),e.TgZ(3,"a",46),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.downloadCsv())}),e._uU(4,"Descargar CSV"),e.qZA()()}}function U(i,a){1&i&&(e.TgZ(0,"div",47)(1,"span",42),e._uU(2,"Loading..."),e.qZA()())}function L(i,a){if(1&i&&(e.TgZ(0,"h4",48),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(),e.Oqu(t.title)}}function J(i,a){if(1&i&&(e.TgZ(0,"div",49)(1,"h5",25),e._uU(2,"Descripci\xf3n:"),e.qZA(),e.TgZ(3,"p",50),e._uU(4),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.Oqu(t.description)}}let M=(()=>{class i{constructor(t,o,n,l,c,Q){this.helmetService=t,this.route=o,this.responseService=n,this.confirmDialogService=l,this.downloadPlatformService=c,this.loadingService=Q,this.BASE_URL=f._n,this.id="0",this.title="",this.description="",this.createdAt="",this.publishedAt="",this.layers=[],this.evidences=[],this.helmetlessCount=0,this.helmetCount=0,this.detailLoading=!0,this.downloadLoading=!1,this.slideConfig={infinite:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0},this.slidesConfig={infinite:!0,slidesToShow:4,slidesToScroll:1,autoplay:!0}}ngOnInit(){this.breadCrumbItems=[{label:"Uso de casco"},{label:"Detalle",active:!0}],this.route.paramMap.subscribe({next:t=>{this.id=t.get("id")||"0",this.helmetService.getDetail(this.id).subscribe({next:o=>{this.markers={layers:[(0,d.tileLayer)("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidGhlbWVzYnJhbmQiLCJhIjoiY2xmbmc3bTV4MGw1ejNzbnJqOWpubzhnciJ9.DNkdZVKLnQ6I9NOz7EED-w",{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xa9 <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1})],zoom:13,zoomControl:!1,center:(0,d.latLng)(o.data.lat,o.data.lng)};var n=new d.Icon.Default;n.options.shadowSize=[0,0];const l=(0,d.marker)([o.data.lat,o.data.lng],{draggable:!1,icon:n});this.layers.push(l),this.title=o.data.title,this.description=o.data.description,this.createdAt=`${o.data.date} ${o.data.time}`,this.evidences=o.data.evidences.map(c=>this.getAuditoryUrl(c.dir)),this.helmetCount=o.data.counts[0].helmets_count,this.helmetlessCount=o.data.counts[0].users_count,this.detailLoading=!1},error:o=>{this.responseService.onError(o,"No se pudo recuperar la auditor\xeda"),this.detailLoading=!1}})}})}getAuditoryUrl(t){return f._n+"/storage/helmet/"+t+".jpeg"}previousSlide(){this.slickModal.slickPrev()}nextSlide(){this.slickModal.slickNext()}downloadCsv(){this.confirmDialogService.showDialog("Confirmaci\xf3n","\xbfDesea descargar en formato CSV?").then(t=>{if(t.isConfirmed){this.downloadLoading=!0;const l=new Blob(["\ufeffTipo,conteo\n"+("Sin Casco,"+this.helmetlessCount+"\nCon Casco,"+this.helmetCount)],{type:"text/csv;charset=utf-8"});this.downloadPlatformService.downloadBlob(l,this.title,"csv"),this.downloadLoading=!1}})}downloadPdf(){var t=this;this.confirmDialogService.showDialog("Confirmaci\xf3n","\xbfDesea descargar en formato PDF?").then(o=>{var n;o.isConfirmed&&(this.downloadLoading=!0,this.loadingService.show(),this.helmetService.downloadPdf(this.id).subscribe({next:(n=(0,g.Z)(function*(l){t.downloadPlatformService.downloadBlob(l,t.title,"pdf"),t.downloadLoading=!1}),function(c){return n.apply(this,arguments)}),error:n=>{this.responseService.onError(n,"No se pudo descargar el archivo"),this.downloadLoading=!1}}))})}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(x.v),e.Y36(p.gz),e.Y36(C.J),e.Y36(w.D),e.Y36(Z.A),e.Y36(b.b))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-helmet-detail"]],viewQuery:function(o,n){if(1&o&&e.Gf(S,5),2&o){let l;e.iGM(l=e.CRH())&&(n.slickModal=l.first)}},decls:36,vars:11,consts:[[1,"row"],[1,"col-xl-8","offset-xl-2"],["title","Detalle de uso de casco",3,"breadcrumbItems"],[1,"col-xl-4"],[1,"card"],[1,"card-body"],[1,"fs-md"],["style","height: 300px;","leaflet","",3,"leafletOptions","leafletLayers",4,"ngIf"],["class","card p-3 sticky-side-div",4,"ngIf"],[1,"col-xl-8"],[1,"row","g-0"],[1,"col"],[1,"card","rounded-end-0"],[1,"card-body","p-4"],["dropdown","",1,"dropdown","float-end"],["dropdownToggle","","href","javascript:void(0);",1,"text-reset","dropdown-btn","btn","btn-primary","p-0","px-1"],["class","spinner-border spinner-border-sm text-light","role","status",4,"ngIf"],["class","fs-xl",4,"ngIf"],["class","dropdown-menu dropdown-menu-end",4,"bsDropdownMenu"],["class","spinner-border spinner-border-sm","role","status",4,"ngIf"],["class","text-capitalize mb-3",4,"ngIf"],[1,"hstack","gap-3","flex-wrap"],[1,"text-muted"],[1,"text-body","fw-medium"],["class","mt-4",4,"ngIf"],[1,"fs-md","mb-3"],["leaflet","",2,"height","300px",3,"leafletOptions","leafletLayers"],[1,"card","p-3","sticky-side-div"],[1,"product-img-slider"],[1,"carousel","swiper","product-thumbnail-slider","p-2","rounded","bg-light",3,"config"],["slickModal",""],["ngxSlickItem","","class","slide",4,"ngFor","ngForOf"],[1,"slick-next","slick-arrow","swiper-button-nexts",3,"click"],[1,"slick-prev","slick-arrow","swiper-button-prevs",3,"click"],[1,"carousel","swiper","product-nav-slider","mt-2",3,"config"],["ngxSlickItem","","class","swiper-slide swiperlist me-2",4,"ngFor","ngForOf"],["ngxSlickItem","",1,"slide"],[1,"mx-4"],["alt","",1,"img-fluid","d-block",3,"src"],["ngxSlickItem","",1,"swiper-slide","swiperlist","me-2"],[1,"nav-slide-item"],["role","status",1,"spinner-border","spinner-border-sm","text-light"],[1,"visually-hidden"],[1,"fs-xl"],[1,"mdi","mdi-download","align-middle","text-white"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0);",1,"dropdown-item","pointer",3,"click"],["role","status",1,"spinner-border","spinner-border-sm"],[1,"text-capitalize","mb-3"],[1,"mt-4"],[1,"text-muted","mb-0"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"app-breadcrumbs",2),e.TgZ(3,"div",0)(4,"div",3)(5,"div",4)(6,"div",5)(7,"h5",6),e._uU(8,"Ubicaci\xf3n"),e.qZA(),e.YNc(9,D,1,2,"div",7),e.qZA()(),e.YNc(10,A,11,4,"div",8),e.qZA(),e.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"a",15),e.YNc(18,k,3,0,"div",16)(19,I,2,0,"span",17),e.qZA(),e.YNc(20,H,5,0,"div",18),e.qZA(),e.YNc(21,U,3,0,"div",19)(22,L,2,1,"h4",20),e.TgZ(23,"div",21)(24,"div",22),e._uU(25,"Realizado : "),e.TgZ(26,"span",23),e._uU(27),e.qZA()()(),e.YNc(28,J,5,1,"div",24),e.qZA()()()(),e.TgZ(29,"div",4)(30,"div",13)(31,"div")(32,"h5",25),e._uU(33),e.qZA(),e.TgZ(34,"h5",25),e._uU(35),e.qZA()()()()()()()()),2&o&&(e.xp6(2),e.Q6J("breadcrumbItems",n.breadCrumbItems),e.xp6(7),e.Q6J("ngIf",n.markers),e.xp6(),e.Q6J("ngIf",n.evidences.length>0),e.xp6(8),e.Q6J("ngIf",n.downloadLoading),e.xp6(),e.Q6J("ngIf",!n.downloadLoading),e.xp6(2),e.Q6J("ngIf",n.detailLoading),e.xp6(),e.Q6J("ngIf",!n.detailLoading),e.xp6(5),e.Oqu(n.createdAt),e.xp6(),e.Q6J("ngIf",n.description),e.xp6(5),e.hij("Usuarios con casco: ",n.helmetCount,""),e.xp6(2),e.hij("Usuarios sin casco: ",n.helmetlessCount,""))},dependencies:[m.sg,m.O5,u.vE,u.Xg,T.n,h.je,h.x,r.Hz,r.Mq,r.TO],encapsulation:2})}return i})();var z=s(3744),N=s(6208);const O=[{path:"",component:M}];let F=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[m.ez,p.Bz.forChild(O),z.t,u.Sv,N.m,h.UO,r.mr,p.Bz]})}return i})()}}]);